<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue ç»„åˆå¼ API | é£è·ƒé«˜å±±ä¸å¤§æ´‹çš„é±¼</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.ico">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="é£è·ƒé«˜å±±ä¸å¤§æ´‹çš„é±¼çš„æ–‡æ¡£, vuepress æ–‡æ¡£">
    <meta name="theme-color" content="#ffffff">
    <meta name="google-site-verification" content="Ld_AEWr30siza2LmmZ12csitRGsSj9gqqEAch0UXkTc">
    
    <link rel="preload" href="/assets/css/0.styles.e554653d.css" as="style"><link rel="preload" href="/assets/js/app.f3bc4e43.js" as="script"><link rel="preload" href="/assets/js/2.93d5c1c0.js" as="script"><link rel="preload" href="/assets/js/138.0cbe3cb0.js" as="script"><link rel="preload" href="/assets/js/4.339569f1.js" as="script"><link rel="prefetch" href="/assets/js/10.a0d20801.js"><link rel="prefetch" href="/assets/js/100.7402ae7a.js"><link rel="prefetch" href="/assets/js/101.25966556.js"><link rel="prefetch" href="/assets/js/102.57830e60.js"><link rel="prefetch" href="/assets/js/103.f1d1320f.js"><link rel="prefetch" href="/assets/js/104.3e1d4e09.js"><link rel="prefetch" href="/assets/js/105.846c88fb.js"><link rel="prefetch" href="/assets/js/106.760408dd.js"><link rel="prefetch" href="/assets/js/107.8ba78d50.js"><link rel="prefetch" href="/assets/js/108.74a7029e.js"><link rel="prefetch" href="/assets/js/109.d4352618.js"><link rel="prefetch" href="/assets/js/11.28807edd.js"><link rel="prefetch" href="/assets/js/110.3bdaca9c.js"><link rel="prefetch" href="/assets/js/111.25d0fa53.js"><link rel="prefetch" href="/assets/js/112.fed24a2c.js"><link rel="prefetch" href="/assets/js/113.b38c10bc.js"><link rel="prefetch" href="/assets/js/114.9d7f7958.js"><link rel="prefetch" href="/assets/js/115.cf72a713.js"><link rel="prefetch" href="/assets/js/116.3902723f.js"><link rel="prefetch" href="/assets/js/117.89d0d440.js"><link rel="prefetch" href="/assets/js/118.b6e4467e.js"><link rel="prefetch" href="/assets/js/119.be455b86.js"><link rel="prefetch" href="/assets/js/12.6542aae9.js"><link rel="prefetch" href="/assets/js/120.7fa0887b.js"><link rel="prefetch" href="/assets/js/121.3cc54aa0.js"><link rel="prefetch" href="/assets/js/122.c547123b.js"><link rel="prefetch" href="/assets/js/123.dddb28b7.js"><link rel="prefetch" href="/assets/js/124.13187c28.js"><link rel="prefetch" href="/assets/js/125.9462eba5.js"><link rel="prefetch" href="/assets/js/126.cf08997c.js"><link rel="prefetch" href="/assets/js/127.d6bf1b70.js"><link rel="prefetch" href="/assets/js/128.20b2d707.js"><link rel="prefetch" href="/assets/js/129.52c6f5de.js"><link rel="prefetch" href="/assets/js/13.96918e4f.js"><link rel="prefetch" href="/assets/js/130.66794f5b.js"><link rel="prefetch" href="/assets/js/131.09dc5f74.js"><link rel="prefetch" href="/assets/js/132.bec47b7e.js"><link rel="prefetch" href="/assets/js/133.42548314.js"><link rel="prefetch" href="/assets/js/134.01d2c5ef.js"><link rel="prefetch" href="/assets/js/135.513f7853.js"><link rel="prefetch" href="/assets/js/136.a56392f5.js"><link rel="prefetch" href="/assets/js/137.e99e0e46.js"><link rel="prefetch" href="/assets/js/139.2c2487a2.js"><link rel="prefetch" href="/assets/js/14.57bcf19e.js"><link rel="prefetch" href="/assets/js/140.ec07504b.js"><link rel="prefetch" href="/assets/js/141.26c662b7.js"><link rel="prefetch" href="/assets/js/142.2bcc8db4.js"><link rel="prefetch" href="/assets/js/143.035ab929.js"><link rel="prefetch" href="/assets/js/144.1c3ae40f.js"><link rel="prefetch" href="/assets/js/145.4d597831.js"><link rel="prefetch" href="/assets/js/146.2aaaa1a8.js"><link rel="prefetch" href="/assets/js/147.2411fee2.js"><link rel="prefetch" href="/assets/js/148.00551d67.js"><link rel="prefetch" href="/assets/js/149.66b5f8ca.js"><link rel="prefetch" href="/assets/js/15.4de3eaae.js"><link rel="prefetch" href="/assets/js/150.58a00d6a.js"><link rel="prefetch" href="/assets/js/151.25b8d304.js"><link rel="prefetch" href="/assets/js/152.a35f9052.js"><link rel="prefetch" href="/assets/js/153.d41e4ac3.js"><link rel="prefetch" href="/assets/js/154.645bf2b1.js"><link rel="prefetch" href="/assets/js/155.6853a1e9.js"><link rel="prefetch" href="/assets/js/156.10218b15.js"><link rel="prefetch" href="/assets/js/157.ef0749bc.js"><link rel="prefetch" href="/assets/js/158.1e9826e8.js"><link rel="prefetch" href="/assets/js/159.5684b162.js"><link rel="prefetch" href="/assets/js/16.50414250.js"><link rel="prefetch" href="/assets/js/160.0f718c75.js"><link rel="prefetch" href="/assets/js/161.8a137a93.js"><link rel="prefetch" href="/assets/js/162.17507b21.js"><link rel="prefetch" href="/assets/js/163.82fcbb86.js"><link rel="prefetch" href="/assets/js/164.17fbcf80.js"><link rel="prefetch" href="/assets/js/165.fb87339d.js"><link rel="prefetch" href="/assets/js/166.d3d864f1.js"><link rel="prefetch" href="/assets/js/167.95a0db05.js"><link rel="prefetch" href="/assets/js/168.0277393c.js"><link rel="prefetch" href="/assets/js/169.7e2f40fb.js"><link rel="prefetch" href="/assets/js/17.f5c75867.js"><link rel="prefetch" href="/assets/js/170.377bc932.js"><link rel="prefetch" href="/assets/js/171.7dfd1319.js"><link rel="prefetch" href="/assets/js/172.d7cbe36a.js"><link rel="prefetch" href="/assets/js/173.cd462eab.js"><link rel="prefetch" href="/assets/js/174.39b8ba1a.js"><link rel="prefetch" href="/assets/js/175.c8114b2b.js"><link rel="prefetch" href="/assets/js/176.e3af279c.js"><link rel="prefetch" href="/assets/js/177.a9b05194.js"><link rel="prefetch" href="/assets/js/178.178af81d.js"><link rel="prefetch" href="/assets/js/179.6362b09f.js"><link rel="prefetch" href="/assets/js/18.8b737bb8.js"><link rel="prefetch" href="/assets/js/180.e94ecfaa.js"><link rel="prefetch" href="/assets/js/181.bc6b6345.js"><link rel="prefetch" href="/assets/js/182.f045354b.js"><link rel="prefetch" href="/assets/js/183.d039948c.js"><link rel="prefetch" href="/assets/js/184.28053079.js"><link rel="prefetch" href="/assets/js/185.2088b1ff.js"><link rel="prefetch" href="/assets/js/186.53022476.js"><link rel="prefetch" href="/assets/js/187.0299a25e.js"><link rel="prefetch" href="/assets/js/188.b7bdd1b5.js"><link rel="prefetch" href="/assets/js/189.e06b7263.js"><link rel="prefetch" href="/assets/js/19.9527e367.js"><link rel="prefetch" href="/assets/js/190.8fa1c6da.js"><link rel="prefetch" href="/assets/js/191.b140bad8.js"><link rel="prefetch" href="/assets/js/192.f92976b8.js"><link rel="prefetch" href="/assets/js/193.ded8ecfd.js"><link rel="prefetch" href="/assets/js/194.a96f6f73.js"><link rel="prefetch" href="/assets/js/195.3529d0f6.js"><link rel="prefetch" href="/assets/js/196.eb0a4807.js"><link rel="prefetch" href="/assets/js/197.152bd038.js"><link rel="prefetch" href="/assets/js/198.597d8cfa.js"><link rel="prefetch" href="/assets/js/199.49453adb.js"><link rel="prefetch" href="/assets/js/20.119220af.js"><link rel="prefetch" href="/assets/js/200.274b30b5.js"><link rel="prefetch" href="/assets/js/201.a65a431b.js"><link rel="prefetch" href="/assets/js/202.d38c85f8.js"><link rel="prefetch" href="/assets/js/203.d6f55845.js"><link rel="prefetch" href="/assets/js/204.a41e56bb.js"><link rel="prefetch" href="/assets/js/205.d7afb6fc.js"><link rel="prefetch" href="/assets/js/206.45f9cd80.js"><link rel="prefetch" href="/assets/js/207.d9c62c91.js"><link rel="prefetch" href="/assets/js/208.30d5ca0c.js"><link rel="prefetch" href="/assets/js/209.20dfcfd0.js"><link rel="prefetch" href="/assets/js/21.119c45e1.js"><link rel="prefetch" href="/assets/js/210.5350239f.js"><link rel="prefetch" href="/assets/js/211.c5546cf9.js"><link rel="prefetch" href="/assets/js/212.fe1ff0e4.js"><link rel="prefetch" href="/assets/js/213.77d1fdb5.js"><link rel="prefetch" href="/assets/js/214.f0d69ef6.js"><link rel="prefetch" href="/assets/js/215.eb3356c8.js"><link rel="prefetch" href="/assets/js/216.2f0565eb.js"><link rel="prefetch" href="/assets/js/217.18f446a8.js"><link rel="prefetch" href="/assets/js/218.0b7c1cb0.js"><link rel="prefetch" href="/assets/js/219.15541f53.js"><link rel="prefetch" href="/assets/js/22.565ed291.js"><link rel="prefetch" href="/assets/js/220.eaef9916.js"><link rel="prefetch" href="/assets/js/221.a024df6c.js"><link rel="prefetch" href="/assets/js/222.248407f2.js"><link rel="prefetch" href="/assets/js/223.d286f3d1.js"><link rel="prefetch" href="/assets/js/224.17585052.js"><link rel="prefetch" href="/assets/js/225.ece8f884.js"><link rel="prefetch" href="/assets/js/226.8c9a472d.js"><link rel="prefetch" href="/assets/js/227.024fbc47.js"><link rel="prefetch" href="/assets/js/228.23f030e3.js"><link rel="prefetch" href="/assets/js/229.f19601db.js"><link rel="prefetch" href="/assets/js/23.f0d67525.js"><link rel="prefetch" href="/assets/js/230.e8cd3309.js"><link rel="prefetch" href="/assets/js/231.692f5cb6.js"><link rel="prefetch" href="/assets/js/232.07e36e28.js"><link rel="prefetch" href="/assets/js/233.d640fb7f.js"><link rel="prefetch" href="/assets/js/234.5f276e20.js"><link rel="prefetch" href="/assets/js/235.0d0139d0.js"><link rel="prefetch" href="/assets/js/236.369d8f3b.js"><link rel="prefetch" href="/assets/js/237.4e190723.js"><link rel="prefetch" href="/assets/js/238.8039f6a3.js"><link rel="prefetch" href="/assets/js/239.b068f876.js"><link rel="prefetch" href="/assets/js/24.f38ffb68.js"><link rel="prefetch" href="/assets/js/240.8fe113df.js"><link rel="prefetch" href="/assets/js/241.04c9a621.js"><link rel="prefetch" href="/assets/js/242.aec6beb5.js"><link rel="prefetch" href="/assets/js/243.f3aae9e9.js"><link rel="prefetch" href="/assets/js/25.c049158b.js"><link rel="prefetch" href="/assets/js/26.259b0a50.js"><link rel="prefetch" href="/assets/js/27.ba95c81b.js"><link rel="prefetch" href="/assets/js/28.3b7cc014.js"><link rel="prefetch" href="/assets/js/29.11cff7f7.js"><link rel="prefetch" href="/assets/js/3.89546440.js"><link rel="prefetch" href="/assets/js/30.07f98bd7.js"><link rel="prefetch" href="/assets/js/31.9a370c40.js"><link rel="prefetch" href="/assets/js/32.1e4cddd7.js"><link rel="prefetch" href="/assets/js/33.9b9b6ca5.js"><link rel="prefetch" href="/assets/js/34.198d1e3e.js"><link rel="prefetch" href="/assets/js/35.cc4d049c.js"><link rel="prefetch" href="/assets/js/36.e93c94a9.js"><link rel="prefetch" href="/assets/js/37.0a73ec16.js"><link rel="prefetch" href="/assets/js/38.5fdacc34.js"><link rel="prefetch" href="/assets/js/39.3462ae29.js"><link rel="prefetch" href="/assets/js/40.7507f434.js"><link rel="prefetch" href="/assets/js/41.9f3fd2c1.js"><link rel="prefetch" href="/assets/js/42.9acfb6a0.js"><link rel="prefetch" href="/assets/js/43.028d37de.js"><link rel="prefetch" href="/assets/js/44.dc7af4e0.js"><link rel="prefetch" href="/assets/js/45.f791596f.js"><link rel="prefetch" href="/assets/js/46.5f6367ea.js"><link rel="prefetch" href="/assets/js/47.23e0116d.js"><link rel="prefetch" href="/assets/js/48.9743d91a.js"><link rel="prefetch" href="/assets/js/49.d9bc1351.js"><link rel="prefetch" href="/assets/js/5.d1f19d5b.js"><link rel="prefetch" href="/assets/js/50.0af62eb1.js"><link rel="prefetch" href="/assets/js/51.feb74d94.js"><link rel="prefetch" href="/assets/js/52.6930b461.js"><link rel="prefetch" href="/assets/js/53.dc3296c8.js"><link rel="prefetch" href="/assets/js/54.57659bce.js"><link rel="prefetch" href="/assets/js/55.43547f85.js"><link rel="prefetch" href="/assets/js/56.6c98b362.js"><link rel="prefetch" href="/assets/js/57.8229a049.js"><link rel="prefetch" href="/assets/js/58.81c28de9.js"><link rel="prefetch" href="/assets/js/59.138a89a4.js"><link rel="prefetch" href="/assets/js/6.2dc682a7.js"><link rel="prefetch" href="/assets/js/60.bd25cf52.js"><link rel="prefetch" href="/assets/js/61.8727d787.js"><link rel="prefetch" href="/assets/js/62.8445d943.js"><link rel="prefetch" href="/assets/js/63.c800805e.js"><link rel="prefetch" href="/assets/js/64.214bba6e.js"><link rel="prefetch" href="/assets/js/65.c8632f2e.js"><link rel="prefetch" href="/assets/js/66.c3d7e780.js"><link rel="prefetch" href="/assets/js/67.6890e0d1.js"><link rel="prefetch" href="/assets/js/68.7727eb98.js"><link rel="prefetch" href="/assets/js/69.14a9554b.js"><link rel="prefetch" href="/assets/js/7.2587e59c.js"><link rel="prefetch" href="/assets/js/70.4bf00af5.js"><link rel="prefetch" href="/assets/js/71.b17a78df.js"><link rel="prefetch" href="/assets/js/72.4ed7fbfb.js"><link rel="prefetch" href="/assets/js/73.606dedb9.js"><link rel="prefetch" href="/assets/js/74.db725d11.js"><link rel="prefetch" href="/assets/js/75.d33f6625.js"><link rel="prefetch" href="/assets/js/76.fdf31f69.js"><link rel="prefetch" href="/assets/js/77.ae894bd8.js"><link rel="prefetch" href="/assets/js/78.ff8d8588.js"><link rel="prefetch" href="/assets/js/79.07f6e12a.js"><link rel="prefetch" href="/assets/js/8.f5666732.js"><link rel="prefetch" href="/assets/js/80.f21590f1.js"><link rel="prefetch" href="/assets/js/81.b4e4cc00.js"><link rel="prefetch" href="/assets/js/82.46a30a2a.js"><link rel="prefetch" href="/assets/js/83.79915984.js"><link rel="prefetch" href="/assets/js/84.b9944f4b.js"><link rel="prefetch" href="/assets/js/85.4e27ff28.js"><link rel="prefetch" href="/assets/js/86.5cad870b.js"><link rel="prefetch" href="/assets/js/87.35b115ee.js"><link rel="prefetch" href="/assets/js/88.d0c1ea42.js"><link rel="prefetch" href="/assets/js/89.094f6d6a.js"><link rel="prefetch" href="/assets/js/9.25ae8f9a.js"><link rel="prefetch" href="/assets/js/90.1fdf86a3.js"><link rel="prefetch" href="/assets/js/91.985f557c.js"><link rel="prefetch" href="/assets/js/92.d82bbfb8.js"><link rel="prefetch" href="/assets/js/93.983d7fd0.js"><link rel="prefetch" href="/assets/js/94.046ee311.js"><link rel="prefetch" href="/assets/js/95.b0e28ffe.js"><link rel="prefetch" href="/assets/js/96.8b9f228e.js"><link rel="prefetch" href="/assets/js/97.bab27371.js"><link rel="prefetch" href="/assets/js/98.0d346986.js"><link rel="prefetch" href="/assets/js/99.f4640a01.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e554653d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">é£è·ƒé«˜å±±ä¸å¤§æ´‹çš„é±¼</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  å…ˆå¯¼
</a></div><div class="nav-item"><a href="/computer/" class="nav-link">
  è®¡ç®—æœº
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç³»ç»Ÿ" class="dropdown-title"><span class="title">ç³»ç»Ÿ</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç³»ç»Ÿ" class="mobile-dropdown-title"><span class="title">ç³»ç»Ÿ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/os/manjaro/" class="nav-link">
  Manjaro
</a></li><li class="dropdown-item"><!----> <a href="/os/ubuntu/" class="nav-link">
  Ubuntu
</a></li><li class="dropdown-item"><!----> <a href="/os/centos/" class="nav-link">
  CentOS
</a></li><li class="dropdown-item"><!----> <a href="/os/kubernetes/" class="nav-link">
  Kubernetes
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯" class="dropdown-title"><span class="title">å‰ç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯" class="mobile-dropdown-title"><span class="title">å‰ç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link router-link-active">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/frontend/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/frontend/flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/frontend/weapp/" class="nav-link">
  weapp
</a></li><li class="dropdown-item"><!----> <a href="/frontend/d3js/" class="nav-link">
  D3
</a></li><li class="dropdown-item"><!----> <a href="/frontend/jest/" class="nav-link">
  Jest
</a></li><li class="dropdown-item"><!----> <a href="/frontend/utils/" class="nav-link">
  Utils
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åç«¯" class="dropdown-title"><span class="title">åç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="åç«¯" class="mobile-dropdown-title"><span class="title">åç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/backend/nestjs/" class="nav-link">
  Nestjs
</a></li><li class="dropdown-item"><!----> <a href="/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/backend/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/backend/traefik/" class="nav-link">
  Traefik
</a></li><li class="dropdown-item"><!----> <a href="/backend/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/backend/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/backend/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/backend/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•" class="dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç®—æ³•" class="mobile-dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/sort/" class="nav-link">
  æ’åº
</a></li><li class="dropdown-item"><!----> <a href="/algorithms/divide-and-conquer/" class="nav-link">
  åˆ†è€Œæ²»ä¹‹
</a></li><li class="dropdown-item"><!----> <a href="/algorithms/dynamic-programming/" class="nav-link">
  åŠ¨æ€è§„åˆ’
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¼€å‘å·¥å…·" class="dropdown-title"><span class="title">å¼€å‘å·¥å…·</span> <span class="arrow down"></span></button> <button type="button" aria-label="å¼€å‘å·¥å…·" class="mobile-dropdown-title"><span class="title">å¼€å‘å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/tools/github/" class="nav-link">
  Github
</a></li><li class="dropdown-item"><!----> <a href="/tools/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/tools/chrome/" class="nav-link">
  Chrome Developer tools
</a></li><li class="dropdown-item"><!----> <a href="/tools/bookmark-scripts/" class="nav-link">
  Bookmark scripts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ›´å¤š" class="dropdown-title"><span class="title">æ›´å¤š</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ›´å¤š" class="mobile-dropdown-title"><span class="title">æ›´å¤š</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/æ›´å¤šğŸ‰/navigation.html" class="nav-link">
  å¯¼èˆª ğŸ‰
</a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress å®˜ç½‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/shanyuhai123/documents" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  å…ˆå¯¼
</a></div><div class="nav-item"><a href="/computer/" class="nav-link">
  è®¡ç®—æœº
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç³»ç»Ÿ" class="dropdown-title"><span class="title">ç³»ç»Ÿ</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç³»ç»Ÿ" class="mobile-dropdown-title"><span class="title">ç³»ç»Ÿ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/os/manjaro/" class="nav-link">
  Manjaro
</a></li><li class="dropdown-item"><!----> <a href="/os/ubuntu/" class="nav-link">
  Ubuntu
</a></li><li class="dropdown-item"><!----> <a href="/os/centos/" class="nav-link">
  CentOS
</a></li><li class="dropdown-item"><!----> <a href="/os/kubernetes/" class="nav-link">
  Kubernetes
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å‰ç«¯" class="dropdown-title"><span class="title">å‰ç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="å‰ç«¯" class="mobile-dropdown-title"><span class="title">å‰ç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/typescript/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link router-link-active">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/frontend/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/frontend/flutter/" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/frontend/weapp/" class="nav-link">
  weapp
</a></li><li class="dropdown-item"><!----> <a href="/frontend/d3js/" class="nav-link">
  D3
</a></li><li class="dropdown-item"><!----> <a href="/frontend/jest/" class="nav-link">
  Jest
</a></li><li class="dropdown-item"><!----> <a href="/frontend/utils/" class="nav-link">
  Utils
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åç«¯" class="dropdown-title"><span class="title">åç«¯</span> <span class="arrow down"></span></button> <button type="button" aria-label="åç«¯" class="mobile-dropdown-title"><span class="title">åç«¯</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/nodejs/" class="nav-link">
  Nodejs
</a></li><li class="dropdown-item"><!----> <a href="/backend/nestjs/" class="nav-link">
  Nestjs
</a></li><li class="dropdown-item"><!----> <a href="/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/backend/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/backend/traefik/" class="nav-link">
  Traefik
</a></li><li class="dropdown-item"><!----> <a href="/backend/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/backend/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/backend/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/backend/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•" class="dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç®—æ³•" class="mobile-dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/algorithms/sort/" class="nav-link">
  æ’åº
</a></li><li class="dropdown-item"><!----> <a href="/algorithms/divide-and-conquer/" class="nav-link">
  åˆ†è€Œæ²»ä¹‹
</a></li><li class="dropdown-item"><!----> <a href="/algorithms/dynamic-programming/" class="nav-link">
  åŠ¨æ€è§„åˆ’
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å¼€å‘å·¥å…·" class="dropdown-title"><span class="title">å¼€å‘å·¥å…·</span> <span class="arrow down"></span></button> <button type="button" aria-label="å¼€å‘å·¥å…·" class="mobile-dropdown-title"><span class="title">å¼€å‘å·¥å…·</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/tools/github/" class="nav-link">
  Github
</a></li><li class="dropdown-item"><!----> <a href="/tools/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/tools/chrome/" class="nav-link">
  Chrome Developer tools
</a></li><li class="dropdown-item"><!----> <a href="/tools/bookmark-scripts/" class="nav-link">
  Bookmark scripts
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="æ›´å¤š" class="dropdown-title"><span class="title">æ›´å¤š</span> <span class="arrow down"></span></button> <button type="button" aria-label="æ›´å¤š" class="mobile-dropdown-title"><span class="title">æ›´å¤š</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/æ›´å¤šğŸ‰/navigation.html" class="nav-link">
  å¯¼èˆª ğŸ‰
</a></li><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VuePress å®˜ç½‘
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/shanyuhai123/documents" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>VUE</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/vue/" aria-current="page" class="sidebar-link">Vue</a></li><li><a href="/frontend/vue/vue-composition-api.html" aria-current="page" class="active sidebar-link">Vue ç»„åˆå¼ API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#setup" class="sidebar-link">setup</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#å“åº”å¼ç³»ç»Ÿ-api" class="sidebar-link">å“åº”å¼ç³»ç»Ÿ API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_1-reactive" class="sidebar-link">1. reactive</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_2-ref" class="sidebar-link">2. ref</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_3-computed" class="sidebar-link">3. computed</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_4-readonly" class="sidebar-link">4. readonly</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_5-watcheffect" class="sidebar-link">5. watchEffect</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_6-watch" class="sidebar-link">6. watch</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°" class="sidebar-link">ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_1-ä¸-2-x-ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸå¯¹åº”çš„ç»„åˆå¼-api" class="sidebar-link">1. ä¸ 2.x ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸå¯¹åº”çš„ç»„åˆå¼ API</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_2-æ–°å¢çš„é’©å­å‡½æ•°" class="sidebar-link">2. æ–°å¢çš„é’©å­å‡½æ•°</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#ä¾èµ–æ³¨å…¥" class="sidebar-link">ä¾èµ–æ³¨å…¥</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_1-æ³¨å…¥çš„å“åº”æ€§" class="sidebar-link">1. æ³¨å…¥çš„å“åº”æ€§</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_2-ç±»å‹å®šä¹‰" class="sidebar-link">2. ç±»å‹å®šä¹‰</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#æ¨¡æ¿-refs" class="sidebar-link">æ¨¡æ¿ Refs</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_1-é…åˆ-render-jsx" class="sidebar-link">1. é…åˆ render/JSX</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_2-v-for-ä¸­ä½¿ç”¨" class="sidebar-link">2. v-for ä¸­ä½¿ç”¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#å“åº”å¼ç³»ç»Ÿå·¥å…·é›†" class="sidebar-link">å“åº”å¼ç³»ç»Ÿå·¥å…·é›†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_1-unref" class="sidebar-link">1. unref</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_2-toref" class="sidebar-link">2. toRef</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_3-torefs" class="sidebar-link">3. toRefs</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_4-isref" class="sidebar-link">4. isRef</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_5-isproxy" class="sidebar-link">5. isProxy</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_6-isreactive" class="sidebar-link">6. isReactive</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_7-isreadonly" class="sidebar-link">7. isReadonly</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#é«˜çº§å“åº”å¼ç³»ç»Ÿ-api" class="sidebar-link">é«˜çº§å“åº”å¼ç³»ç»Ÿ API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_1-customref" class="sidebar-link">1. customRef</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_2-markraw" class="sidebar-link">2. markRaw</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_3-shallowreactive" class="sidebar-link">3. shallowReactive</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_4-shallowreadonly" class="sidebar-link">4. shallowReadonly</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_5-shallowref" class="sidebar-link">5. shallowRef</a></li><li class="sidebar-sub-header"><a href="/frontend/vue/vue-composition-api.html#_6-toraw" class="sidebar-link">6. toRaw</a></li></ul></li></ul></li><li><a href="/frontend/vue/vue3-rfc.html" class="sidebar-link">Vue3 RFC</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="setup"><a href="#setup" class="header-anchor">#</a> setup</h2> <p><code>setup</code> å‡½æ•°æ˜¯ä¸€ä¸ªæ–°çš„ç»„ä»¶é€‰é¡¹ã€‚ä½œä¸ºåœ¨ç»„ä»¶å†…ä½¿ç”¨ Composition API çš„å…¥å£ç‚¹ã€‚</p> <ul><li><p>è°ƒç”¨æ—¶æœº</p> <p>åˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œç„¶ååˆå§‹åŒ– <code>props</code>ï¼Œç´§æ¥ç€å°±è°ƒç”¨ <code>setup</code> å‡½æ•°ã€‚ä»ç”Ÿå‘½å‘¨æœŸé’©å­çš„è§†è§’æ¥çœ‹ï¼Œå®ƒä¼šåœ¨ <code>beforeCreate</code> é’©å­ä¹‹å‰è¢«è°ƒç”¨ã€‚</p></li> <li><p>æ¨¡æ¿ä¸­ä½¿ç”¨</p> <p>å¦‚æœ <code>setup</code> è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™å¯¹è±¡çš„å±æ€§å°†ä¼šè¢«åˆå¹¶åˆ°ç»„ä»¶æ¨¡æ¿çš„æ¸²æŸ“ä¸Šä¸‹æ–‡ï¼š</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    {{ count }} {{ object.foo }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
  
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment">// æš´éœ²ç»™æ¨¡æ¿</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">,</span>
      object
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>æ³¨æ„ <code>setup</code> è¿”å›çš„ ref åœ¨æ¨¡æ¿ä¸­ä¼šè‡ªåŠ¨è§£å¼€ï¼Œä¸éœ€è¦å†™ <code>.value</code>ã€‚</p></li> <li><p>æ¸²æŸ“å‡½æ•°/JSX ä¸­ä½¿ç”¨</p> <p><code>setup</code> ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°ä¸­ä¹Ÿèƒ½ä½¿ç”¨å½“å‰ <code>setup</code> å‡½æ•°ä½œç”¨åŸŸä¸­çš„å“åº”å¼æ•°æ®ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> object <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">.</span>value<span class="token punctuation">,</span> object<span class="token punctuation">.</span>foo<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>å‚æ•°</p> <p>è¯¥å‡½æ•°æ¥æ”¶ <code>props</code> ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ³¨æ„ <code>props</code> å¯¹è±¡æ˜¯å“åº”å¼çš„ï¼Œ<code>watchEffect</code> æˆ– <code>watch</code> ä¼šè§‚å¯Ÿå’Œå“åº” <code>props</code> çš„æ›´æ–°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
		name<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name is: </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> props<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç„¶è€Œä¸è¦è§£æ„ <code>props</code> å¯¹è±¡ï¼Œé‚£æ ·ä¼šä½¿å…¶å¤±å»å“åº”æ€§ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
		name<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">name is: </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> name<span class="token punctuation">)</span> <span class="token comment">// Will not be reactive!</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œ<code>props</code> å¯¹è±¡å¯¹ç”¨æˆ·ç©ºé—´ä»£ç æ˜¯ä¸å¯å˜çš„ï¼ˆç”¨æˆ·ä»£ç å°è¯•ä¿®æ”¹ <code>props</code> æ—¶è§¦å‘è­¦å‘Šï¼‰ã€‚</p> <p>ç¬¬äºŒä¸ªå‚æ•°æä¾›äº†ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä»åŸæ¥ 2.x ä¸­ <code>this</code> é€‰æ‹©æ€§åœ°æš´éœ²äº†ä¸€äº› propertyã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context<span class="token punctuation">.</span>attrs
    context<span class="token punctuation">.</span>slots
    context<span class="token punctuation">.</span>emit
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>attrs</code> å’Œ <code>slots</code> éƒ½æ˜¯å†…éƒ¨ç»„ä»¶å®ä¾‹ä¸Šå¯¹åº”é¡¹çš„ä»£ç†ï¼Œå¯ä»¥ç¡®ä¿åœ¨æ›´æ–°åä»ç„¶æ˜¯æœ€æ–°å€¼ã€‚æ‰€ä»¥å¯ä»¥è¢«è§£æ„ï¼Œæ— éœ€æ‹…å¿ƒåé¢è®¿é—®åˆ°è¿‡æœŸçš„å€¼ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> attrs <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¸€ä¸ªå¯èƒ½ä¹‹åå›è°ƒç”¨çš„ç­¾å</span>
    <span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>attrs<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment">// ä¸€å®šæ˜¯æœ€æ–°çš„å¼•ç”¨ï¼Œæ²¡æœ‰ä¸¢å¤±å“åº”æ€§</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å‡ºäºä¸€äº›åŸå› å°† <code>props</code> ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯åŒ…å«åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼š</p> <ul><li>ç»„ä»¶ä½¿ç”¨ <code>props</code> çš„åœºæ™¯æ›´å¤šï¼Œæœ‰æ—¶å€™ç”šè‡³åªä½¿ç”¨ <code>props</code></li> <li>å°† <code>props</code> ç‹¬ç«‹å‡ºæ¥ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥è®© TypeScript å¯¹ <code>props</code> å•ç‹¬åšç±»å‹æ¨å¯¼ï¼Œä¸ä¼šå’Œä¸Šä¸‹æ–‡ä¸­çš„å…¶ä»–å±æ€§æƒ³æ··æ·†ã€‚è¿™ä¹Ÿä½¿å¾— <code>setup</code>ã€<code>render</code> å’Œå…¶ä»–ä½¿ç”¨äº† TSX çš„å‡½æ•°å¼ç»„ä»¶çš„ç­¾åä¿æŒä¸€è‡´ã€‚</li></ul></li> <li><p><code>this</code> çš„ç”¨æ³•</p> <p><code>this</code> åœ¨ <code>setup()</code> ä¸­ä¸å¯ç”¨ã€‚ç”±äº <code>setup()</code> åœ¨è§£æ 2.x é€‰é¡¹å‰è¢«è°ƒç”¨ï¼Œ<code>setup()</code> ä¸­çš„ <code>this</code> å°†ä¸ 2.x é€‰é¡¹ä¸­çš„ <code>this</code> å®Œå…¨ä¸åŒã€‚åŒæ—¶åœ¨ <code>setup()</code> å’Œ 2.x é€‰é¡¹ä¸­ä½¿ç”¨ <code>this</code> æ—¶å°†é€ æˆæ··ä¹±ã€‚åœ¨ <code>setup()</code> ä¸­é¿å…è¿™ç§æƒ…å†µçš„å¦ä¸€ä¸ªåŸå› æ˜¯ï¼šè¿™å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œæ··æ·†è¿™ä¸¤ç§æƒ…å†µçš„ <code>this</code> æ˜¯éå¸¸å¸¸è§çš„é”™è¯¯ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span> <span class="token comment">// è¿™é‡Œ `this` ä¸ä½ æœŸæœ›çš„ä¸ä¸€æ ·ï¼</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>ç±»å‹å®šä¹‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Data</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> unknown
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">SetupContext</span> <span class="token punctuation">{</span>
  attrs<span class="token operator">:</span> Data
  slots<span class="token operator">:</span> Slots
  <span class="token function-variable function">emit</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> unknown<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token operator">:</span> Data<span class="token punctuation">,</span> context<span class="token operator">:</span> SetupContext</span><span class="token punctuation">)</span><span class="token operator">:</span> Data
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">æç¤º</p> <p>ä¸ºäº†è·å¾—ä¼ é€’ç»™ <code>setup()</code> å‚æ•°çš„ç±»å‹æ¨æ–­ï¼Œéœ€è¦ä½¿ç”¨ <code>defineComponent</code>ã€‚</p></div></li></ul> <h2 id="å“åº”å¼ç³»ç»Ÿ-api"><a href="#å“åº”å¼ç³»ç»Ÿ-api" class="header-anchor">#</a> å“åº”å¼ç³»ç»Ÿ API</h2> <h3 id="_1-reactive"><a href="#_1-reactive" class="header-anchor">#</a> 1. reactive</h3> <p>æ¥æ”¶ä¸€ä¸ªæ™®é€šå¯¹è±¡ç„¶åè¿”å›è¯¥æ™®é€šå¯¹è±¡çš„å“åº”å¼ä»£ç†ã€‚ç­‰åŒäº 2.x çš„ <code>Vue.observable()</code>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å“åº”å¼è½¬æ¢æ˜¯ â€œæ·±å±‚çš„â€ï¼šä¼šå½±å“å¯¹è±¡å†…éƒ¨æ‰€æœ‰åµŒå¥—çš„å±æ€§ã€‚åŸºäº ES2015 çš„ Proxy å®ç°ï¼Œè¿”å›çš„ä»£ç†å¯¹è±¡ä¸ç­‰äºåŸå§‹å¯¹è±¡ã€‚å»ºè®®ä»…ä½¿ç”¨ä»£ç†å¯¹è±¡è€Œé¿å…ä¾èµ–åŸå§‹å¯¹è±¡ã€‚</p> <ul><li><p>ç±»å‹å®šä¹‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> reactive<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>raw<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span>
</code></pre></div></li></ul> <h3 id="_2-ref"><a href="#_2-ref" class="header-anchor">#</a> 2. ref</h3> <p>æ¥å—ä¸€ä¸ªå‚æ•°å€¼å¹¶è¿”å›ä¸€ä¸ªå“åº”å¼ä¸”å¯æ”¹å˜çš„ ref å¯¹è±¡ã€‚ref å¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªæŒ‡å‘å†…éƒ¨å€¼çš„å•ä¸€å±æ€§ <code>.value</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 0</span>

count<span class="token punctuation">.</span>value<span class="token operator">++</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><p>å¦‚æœä¼ å…¥ ref çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°†è°ƒç”¨ <code>reactive</code> æ–¹æ³•è¿›è¡Œæ·±å±‚å“åº”è½¬æ¢ã€‚</p> <ul><li><p>æ¨¡æ¿ä¸­è®¿é—®</p> <p>å½“ ref ä½œä¸ºæ¸²æŸ“ä¸Šä¸‹æ–‡çš„å±æ€§è¿”å›ï¼ˆå³åœ¨ <code>setup()</code> è¿”å›çš„çš„å¯¹è±¡ä¸­ï¼‰å¹¶åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨è§£å¥—ï¼Œæ— éœ€åœ¨æ¨¡æ¿å†…é¢å¤–ä¹¦å†™ <code>.value</code>ï¼š</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count<span class="token operator">:</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>ä½œä¸ºå“åº”å¼å¯¹è±¡çš„å±æ€§è®¿é—®</p> <p>å½“ ref ä½œä¸º reactive å¯¹è±¡çš„ property è¢«è®¿é—®æˆ–ä¿®æ”¹æ—¶ï¼Œä¹Ÿå°†è‡ªåŠ¨è§£å¥— value å€¼ï¼Œå…¶è¡Œä¸ºç±»ä¼¼æ™®é€šå±æ€§ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count <span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// 0</span>

state<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><p>æ³¨æ„å¦‚æœå°†ä¸€ä¸ªæ–°çš„ ref åˆ†é…ç»™å‡ºç°æœ‰ refï¼Œå°†æ›¿æ¢æ—§çš„ refï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> otherCount <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

state<span class="token punctuation">.</span>count <span class="token operator">=</span> otherCount
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 1</span>
</code></pre></div><p>æ³¨æ„å½“åµŒå¥—åœ¨ reactive <code>Object</code> ä¸­æ—¶ï¼Œref æ‰ä¼šè§£å¥—ã€‚ä» <code>Array</code> æˆ–è€… <code>Map</code> ç­‰åŸç”Ÿé›†åˆç±»ä¸­è®¿é—® ref æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨è§£å¥—ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// è¿™é‡Œéœ€è¦ .value</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>

<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// è¿™é‡Œéœ€è¦ .value</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>ç±»å‹å®šä¹‰</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">interface</span> <span class="token class-name">Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
	value<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
</code></pre></div><p>æœ‰æ—¶æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸º ref åšä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„ç±»å‹æ ‡æ³¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è°ƒç”¨ <code>ref</code> æ—¶ä¼ é€’æ³›å‹å‚æ•°æ¥è¦†ç›–é»˜è®¤æ¨å¯¼ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string <span class="token operator">|</span> number<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// foo çš„ç±»å‹: Ref&lt;string | number&gt;</span>

foo<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">123</span> <span class="token comment">// èƒ½å¤Ÿé€šè¿‡ï¼</span>
</code></pre></div></li></ul> <h3 id="_3-computed"><a href="#_3-computed" class="header-anchor">#</a> 3. computed</h3> <p>ä¼ å…¥ä¸€ä¸ª getter å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªé»˜è®¤ä¸å¯æ‰‹åŠ¨ä¿®æ”¹çš„ ref å¯¹è±¡ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>plusOne<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 2</span>

plusOne<span class="token punctuation">.</span>value<span class="token operator">++</span> <span class="token comment">// é”™è¯¯ï¼</span>
</code></pre></div><p>æˆ–è€…ä¼ å…¥ä¸€ä¸ªæ‹¥æœ‰ <code>get</code> å’Œ <code>set</code> å‡½æ•°çš„å¯¹è±¡ï¼Œåˆ›å»ºä¸€ä¸ªå¯æ‰‹åŠ¨ä¿®æ”¹çš„è®¡ç®—çŠ¶æ€ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">.</span>value <span class="token operator">=</span> val <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

plusOne<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 0</span>
</code></pre></div><ul><li><p>ç±»å‹å®šä¹‰</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åªè¯»çš„</span>
<span class="token keyword">function</span> computed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token function-variable function">getter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Readonly<span class="token operator">&lt;</span>Ref<span class="token operator">&lt;</span>Readonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;&gt;&gt;</span>

<span class="token comment">// å¯æ›´æ”¹çš„</span>
<span class="token keyword">function</span> computed<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>options<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>
</code></pre></div></li></ul> <h3 id="_4-readonly"><a href="#_4-readonly" class="header-anchor">#</a> 4. readonly</h3> <p>ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼ˆå“åº”å¼æˆ–æ™®é€šï¼‰æˆ– refï¼Œè¿”å›ä¸€ä¸ªåŸå§‹å¯¹è±¡çš„åªè¯»ä»£ç†ã€‚ä¸€ä¸ªåªè¯»çš„ä»£ç†æ˜¯ â€œæ·±å±‚â€ çš„ï¼Œå¯¹è±¡å†…éƒ¨ä»»ä½•åµŒå¥—çš„å±æ€§ä¹Ÿéƒ½æ˜¯åªè¯»çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> copy <span class="token operator">=</span> <span class="token function">readonly</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span>

<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¾èµ–è¿½è¸ª</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>copy<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// original ä¸Šçš„ä¿®æ”¹ä¼šè§¦å‘ copy ä¸Šçš„ä¾¦å¬</span>
original<span class="token punctuation">.</span>count<span class="token operator">++</span>

<span class="token comment">// æ— æ³•ä¿®æ”¹ copy å¹¶ä¼šè¢«è­¦å‘Š</span>
copy<span class="token punctuation">.</span>count<span class="token operator">++</span> <span class="token comment">// warning!</span>
</code></pre></div><h3 id="_5-watcheffect"><a href="#_5-watcheffect" class="header-anchor">#</a> 5. watchEffect</h3> <p>ç«‹å³æ‰§è¡Œä¼ å…¥çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å“åº”å¼è·Ÿè¸ªå…¶ä¾èµ–ï¼Œå¹¶åœ¨å…¶ä¾èµ–å˜æ›´æ—¶é‡æ–°è¿è¡Œè¯¥å‡½æ•°ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// -&gt; 0</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">.</span>value<span class="token operator">++</span>
  <span class="token comment">// -&gt; 1</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_5-1-åœæ­¢ä¾¦å¬"><a href="#_5-1-åœæ­¢ä¾¦å¬" class="header-anchor">#</a> 5.1 åœæ­¢ä¾¦å¬</h4> <p>å½“ <code>watchEffect</code> åœ¨ç»„ä»¶çš„ <code>setup()</code> å‡½æ•°æˆ–ç”Ÿå‘½å‘¨æœŸé’©å­è¢«è°ƒç”¨æ—¶ï¼Œä¾¦å¬å™¨ä¼šè¢«é“¾æ¥åˆ°è¯¥ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶åœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨åœæ­¢ã€‚</p> <p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥æ˜¾å¼è°ƒç”¨è¿”å›å€¼ä»¥åœæ­¢ä¾¦å¬ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> stop <span class="token operator">=</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ä¹‹å</span>
<span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_5-2-æ¸…é™¤å‰¯ä½œç”¨"><a href="#_5-2-æ¸…é™¤å‰¯ä½œç”¨" class="header-anchor">#</a> 5.2 æ¸…é™¤å‰¯ä½œç”¨</h4> <p>æœ‰æ—¶å‰¯ä½œç”¨å‡½æ•°ä¼šæ‰§è¡Œä¸€äº›å¼‚æ­¥çš„å‰¯ä½œç”¨ï¼Œè¿™äº›å“åº”éœ€è¦åœ¨å…¶å¤±æ•ˆæ—¶æ¸…é™¤ï¼ˆå³å®Œæˆä¹‹å‰çŠ¶æ€å·²æ”¹å˜äº†ï¼‰ã€‚æ‰€ä»¥ä¾¦å¬å‰¯ä½œç”¨ä¼ å…¥çš„å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ª <code>onInvalidate</code> å‡½æ•°ä½œå…¥å‚ï¼Œç”¨æ¥æ³¨å†Œæ¸…ç†å¤±æ•ˆæ—¶çš„å›è°ƒã€‚å½“ä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶ï¼Œè¿™ä¸ªå¤±æ•ˆå›è°ƒä¼šè¢«è§¦å‘ï¼š</p> <ul><li>å‰¯ä½œç”¨å³å°†é‡æ–°æ‰§è¡Œæ—¶</li> <li>ä¾¦å¬å™¨è¢«åœæ­¢ï¼ˆå¦‚æœåœ¨ <code>setup()</code> æˆ–ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­ä½¿ç”¨äº† <code>watchEffect</code>ï¼Œåˆ™åœ¨å¸è½½ç»„ä»¶æ—¶ï¼‰</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">onInvalidate</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token function">performAsyncOperation</span><span class="token punctuation">(</span>id<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token function">onInvalidate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// id æ”¹å˜æ—¶ æˆ– åœæ­¢ä¾¦å¬æ—¶</span>
    <span class="token comment">// å–æ¶ˆä¹‹å‰çš„å¼‚æ­¥æ“ä½œ</span>
    token<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æˆ‘ä»¬ä¹‹æ‰€ä»¥æ˜¯é€šè¿‡ä¼ å…¥ä¸€ä¸ªå‡½æ•°å»æ³¨å†Œå¤±æ•ˆå›è°ƒï¼Œè€Œä¸æ˜¯ä»å›è°ƒè¿”å›å®ƒï¼ˆå¦‚ React <code>useEffect</code> ä¸­çš„æ–¹å¼ï¼‰ï¼Œæ˜¯å› ä¸ºè¿”å›å€¼å¯¹äºå¼‚æ­¥é”™è¯¯å¤„ç†å¾ˆé‡è¦ã€‚</p> <p>åœ¨æ‰§è¡Œæ•°æ®è¯·æ±‚æ—¶ï¼Œå‰¯ä½œç”¨å‡½æ•°å¾€å¾€æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æˆ‘ä»¬çŸ¥é“å¼‚æ­¥å‡½æ•°éƒ½ä¼šéšå¼åœ°è¿”å›ä¸€ä¸ª Promiseï¼Œä½†æ˜¯æ¸…ç†å‡½æ•°å¿…é¡»è¦åœ¨ Promise è¢« resolve ä¹‹å‰è¢«æ³¨å†Œã€‚å¦å¤–ï¼ŒVue ä¾èµ–è¿™ä¸ªè¿”å›çš„ Promise æ¥è‡ªåŠ¨å¤„ç† Promise é“¾ä¸Šçš„æ½œåœ¨é”™è¯¯ã€‚</p> <h4 id="_5-3-å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº"><a href="#_5-3-å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº" class="header-anchor">#</a> 5.3 å‰¯ä½œç”¨åˆ·æ–°æ—¶æœº</h4> <p>Vue çš„å“åº”å¼ç³»ç»Ÿä¼šç¼“å­˜å‰¯ä½œç”¨å‡½æ•°ï¼Œå¹¶å¼‚æ­¥åœ°åˆ·æ–°å®ƒä»¬ï¼Œè¿™æ ·å¯ä»¥é¿å…åŒä¸€ä¸ª tick ä¸­å¤šä¸ªçŠ¶æ€æ”¹å˜å¯¼è‡´ä¸å¿…è¦çš„é‡å¤è°ƒç”¨ï¼Œåœ¨æ ¸å¿ƒçš„å…·ä½“å®ç°ä¸­ï¼Œç»„ä»¶çš„æ›´æ–°å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªè¢«ä¾¦å¬çš„å‰¯ä½œç”¨ã€‚å½“ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å‰¯ä½œç”¨å‡½æ•°è¿›å…¥é˜Ÿåˆ—æ—¶ï¼Œä¼šåœ¨æ‰€æœ‰çš„ç»„ä»¶æ›´æ–°åæ‰§è¡Œï¼š</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p> <ul><li><code>count</code> ä¼šåœ¨åˆå§‹è¿è¡Œæ—¶åŒæ­¥æ‰“å°å‡ºæ¥</li> <li>æ›´æ”¹ <code>count</code> æ—¶ï¼Œå°†åœ¨ç»„ä»¶æ›´æ–°åæ‰§è¡Œå‰¯ä½œç”¨</li></ul> <p>è¯·æ³¨æ„ï¼Œåˆå§‹åŒ–è¿è¡Œæ˜¯åœ¨ç»„ä»¶ <code>mounted</code> ä¹‹å‰æ‰§è¡Œçš„ã€‚å› æ­¤ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨ç¼–å†™å‰¯ä½œç”¨å‡½æ•°æ—¶è®¿é—® DOMï¼ˆæˆ–æ¨¡æ¿ refï¼‰ï¼Œè¯·åœ¨ <code>onMounted</code> é’©å­ä¸­è¿›è¡Œï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// åœ¨è¿™é‡Œå¯ä»¥è®¿é—®åˆ° DOM æˆ–è€… template refs</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å¦‚æœå‰¯ä½œç”¨éœ€è¦åŒæ­¥æˆ–åœ¨ç»„ä»¶æ›´æ–°ä¹‹å‰é‡æ–°è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€ä¸ªæ‹¥æœ‰ <code>flush</code> å±æ€§çš„å¯¹è±¡ä½œä¸ºé€‰é¡¹ï¼ˆé»˜è®¤ä¸º <code>'post'</code>ï¼‰ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åŒæ­¥æ‰§è¡Œ</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    flush<span class="token operator">:</span> <span class="token string">'sync'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// ç»„ä»¶æ›´æ–°å‰æ‰§è¡Œ</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    flush<span class="token operator">:</span> <span class="token string">'pre'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><h4 id="_5-4-ä¾¦å¬å™¨è°ƒè¯•"><a href="#_5-4-ä¾¦å¬å™¨è°ƒè¯•" class="header-anchor">#</a> 5.4 ä¾¦å¬å™¨è°ƒè¯•</h4> <p><code>onTrack</code> å’Œ <code>onTrigger</code> é€‰é¡¹å¯ç”¨äºè°ƒè¯•ä¸€ä¸ªä¾¦å¬å™¨çš„è¡Œä¸ºã€‚</p> <ul><li>å½“ä¸€ä¸ª reactive å¯¹è±¡ç†Ÿæ‚‰æˆ–ä¸€ä¸ª ref ä½œä¸ºä¾èµ–è¢«è¿½è¸ªæ—¶ï¼Œå°†è°ƒç”¨ <code>onTrack</code></li> <li>ä¾èµ–é¡¹å˜æ›´å¯¼è‡´å‰¯ä½œç”¨è¢«è§¦å‘æ—¶ï¼Œå°†è°ƒç”¨ <code>onTrigger</code></li></ul> <p>è¿™ä¸¤ä¸ªå›è°ƒéƒ½å°†æ¥æ”¶åˆ°ä¸€ä¸ªåŒ…å«æœ‰å…³ä¾èµ–é¡¹ä¿¡æ¯çš„è°ƒè¯•å™¨äº‹ä»¶ã€‚å»ºè®®åœ¨ä»¥ä¸‹å›è°ƒä¸­ç¼–å†™ <code>debugger</code> è¯­å¥æ¥æ£€æŸ¥ä¾èµ–å…³ç³»ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watchEffect</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/* å‰¯ä½œç”¨çš„å†…å®¹ */</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function">onTrigger</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">debugger</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p><code>onTrack</code> å’Œ <code>onTrigger</code> ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹ç”Ÿæ•ˆã€‚</p> <h4 id="_5-5-ç±»å‹å®šä¹‰"><a href="#_5-5-ç±»å‹å®šä¹‰" class="header-anchor">#</a> 5.5 ç±»å‹å®šä¹‰</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span>
  <span class="token function-variable function">effect</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">onInvalidate<span class="token operator">:</span> InvalidateCbRegistrator</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  options<span class="token operator">?</span><span class="token operator">:</span> WatchEffectOptions
<span class="token punctuation">)</span><span class="token operator">:</span> StopHandle

<span class="token keyword">interface</span> <span class="token class-name">WatchEffectOptions</span> <span class="token punctuation">{</span>
  flush<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'pre'</span> <span class="token operator">|</span> <span class="token string">'post'</span> <span class="token operator">|</span> <span class="token string">'sync'</span>
  onTrack<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> DebuggerEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
  onTrigger<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token operator">:</span> DebuggerEvent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token keyword">interface</span> <span class="token class-name">DebuggerEvent</span> <span class="token punctuation">{</span>
  effect<span class="token operator">:</span> ReactiveEffect
  target<span class="token operator">:</span> any
  type<span class="token operator">:</span> OperationTypes
  key<span class="token operator">:</span> string <span class="token operator">|</span> symbol <span class="token operator">|</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>

type <span class="token function-variable function">InvalidateCbRegistrator</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-variable function">invalidate</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>

type <span class="token function-variable function">StopHandle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</code></pre></div><h3 id="_6-watch"><a href="#_6-watch" class="header-anchor">#</a> 6. watch</h3> <p><code>watch</code> API å®Œå…¨ç­‰æ•ˆäº 2.x <code>this.$watch</code>ï¼ˆä»¥åŠ <code>watch</code> ä¸­ç›¸åº”çš„é€‰é¡¹ï¼‰ã€‚<code>watch</code> éœ€è¦ä¾¦å¬ç‰¹å®šçš„æ•°æ®æºï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œå‰¯ä½œç”¨ã€‚é»˜è®¤æƒ…å†µæ˜¯æ‡’æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ä»…åœ¨ä¾¦å¬çš„æºå˜æ›´æ—¶æ‰æ‰§è¡Œå›è°ƒã€‚</p> <p>å¯¹æ¯” <code>watchEffect</code>ï¼Œ<code>watch</code> å…è®¸æˆ‘ä»¬ï¼š</p> <ul><li>æ‡’æ‰§è¡Œå‰¯ä½œç”¨</li> <li>æ›´æ˜ç¡®å“ªäº›çŠ¶æ€çš„æ”¹å˜ä¼šè§¦å‘ä¾¦å¬å™¨é‡æ–°è¿è¡Œå‰¯ä½œç”¨</li> <li>è®¿é—®ä¾¦å¬çŠ¶æ€å˜åŒ–å‰åçš„å€¼</li></ul> <h4 id="_6-1-ä¾¦å¬å•ä¸ªæ•°æ®æº"><a href="#_6-1-ä¾¦å¬å•ä¸ªæ•°æ®æº" class="header-anchor">#</a> 6.1 ä¾¦å¬å•ä¸ªæ•°æ®æº</h4> <p>ä¾¦å¬å™¨çš„æ•°æ®æºå¯ä»¥æ˜¯ä¸€ä¸ªæ‹¥æœ‰è¿”å›å€¼çš„ getter å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ refï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ä¾¦å¬ä¸€ä¸ª getter</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> prevCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// ä¾¦å¬ä¸€ä¸ª ref</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">count<span class="token punctuation">,</span> prevCount</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_6-2-ä¾¦å¬å¤šä¸ªæ•°æ®æº"><a href="#_6-2-ä¾¦å¬å¤šä¸ªæ•°æ®æº" class="header-anchor">#</a> 6.2 ä¾¦å¬å¤šä¸ªæ•°æ®æº</h4> <p><code>watcher</code> ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„æ¥åŒæ—¶ä¾¦å¬å¤šä¸ªæºï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fooRef<span class="token punctuation">,</span> barRef<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>prevFoo<span class="token punctuation">,</span> prevBar<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ... */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_6-3-ä¸-watcheffect-å…±äº«çš„è¡Œä¸º"><a href="#_6-3-ä¸-watcheffect-å…±äº«çš„è¡Œä¸º" class="header-anchor">#</a> 6.3 ä¸ watchEffect å…±äº«çš„è¡Œä¸º</h4> <p>watch å’Œ watchEffect åœ¨åœæ­¢ä¾¦å¬ï¼Œæ¸…é™¤å‰¯ä½œç”¨ã€å‰¯ä½œç”¨åˆ·æ–°æ—¶æœºå’Œä¾¦å¬å™¨è°ƒè¯•ç­‰æ–¹é¢è¡Œä¸ºä¸€è‡´ã€‚</p> <h4 id="_6-4-ç±»å‹å®šä¹‰"><a href="#_6-4-ç±»å‹å®šä¹‰" class="header-anchor">#</a> 6.4 ç±»å‹å®šä¹‰</h4> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// ä¾¦å¬å•æ•°æ®æº</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">watch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
	source<span class="token operator">:</span> WatcherSource<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span>
  	<span class="token parameter">value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
   	oldValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
   	onInvalidate<span class="token operator">:</span> InvalidateCbRegistrator</span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  options<span class="token operator">?</span><span class="token operator">:</span> WatchOptions 
<span class="token punctuation">)</span><span class="token operator">:</span> StopHandle

<span class="token comment">// ä¾¦å¬å¤šæ•°æ®æº</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">watch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> WatcherSource<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
	sources<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  <span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span>
  	<span class="token parameter">values<span class="token operator">:</span> MapSources<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    oldValues<span class="token operator">:</span> MapSources<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    onInvalidate<span class="token operator">:</span> InvalidateCbRegistrator</span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  options<span class="token operator">?</span><span class="token operator">:</span> WatchOptions
<span class="token punctuation">)</span><span class="token operator">:</span> StopHanle

<span class="token keyword">type</span> <span class="token class-name">WatcherSource<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span><span class="token punctuation">)</span>

<span class="token keyword">type</span> <span class="token class-name">MapSources<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>k <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">WatcherSource<span class="token operator">&lt;</span>infer <span class="token constant">V</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> <span class="token constant">V</span> <span class="token operator">:</span> <span class="token builtin">never</span>
<span class="token punctuation">}</span>

<span class="token comment">// å…±æœ‰çš„å±æ€§ è¯·æŸ¥çœ‹ `watchEffect` çš„ç±»å‹å®šä¹‰</span>
<span class="token keyword">interface</span> <span class="token class-name">WatchOptions</span> <span class="token keyword">extends</span> <span class="token class-name">WatchEffectOptions</span> <span class="token punctuation">{</span>
  immediate<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token comment">// default: false</span>
  deep<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°"><a href="#ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°" class="header-anchor">#</a> ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°</h2> <p>å¯ä»¥ç›´æ¥å¯¼å…¥ <code>onXXX</code> ä¸€æ—çš„å‡½æ•°æ¥æ³¨å†Œç”Ÿå‘½å‘¨æœŸé’©å­ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted<span class="token punctuation">,</span> onUpdated<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mounted!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">onUpdated</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'updated!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'unmounted!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™äº›ç”Ÿå‘½å‘¨æœŸé’©å­æ³¨å†Œå‡½æ•°åªèƒ½åœ¨ <code>setup()</code> æœŸé—´åŒæ­¥ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºå†…éƒ¨çš„å…¨å±€çŠ¶æ€æ¥å®šä½å½“å‰ç»„ä»¶å®ä¾‹ï¼ˆæ­£åœ¨è°ƒç”¨ <code>setup()</code> çš„ç»„ä»¶å®ä¾‹ï¼‰ï¼Œä¸å†å½“å‰ç»„ä»¶ä¸‹è°ƒç”¨è¿™äº›å‡½æ•°ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p> <p>ç»„ä»¶å®ä¾‹ä¸Šä¸‹æ–‡ä¹Ÿæ˜¯åœ¨ç”Ÿå‘½å‘¨æœŸé’©å­åŒæ­¥æ‰§è¡ŒæœŸé—´è®¾ç½®çš„ï¼Œå› æ­¤ï¼Œåœ¨å¸è½½ç»„ä»¶æ—¶ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸé’©å­å†…éƒ¨åŒæ­¥åˆ›å»ºçš„ä¾¦å¬å™¨å’Œè®¡ç®—çŠ¶æ€ä¹Ÿå°†è‡ªåŠ¨åˆ é™¤ã€‚</p> <h3 id="_1-ä¸-2-x-ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸå¯¹åº”çš„ç»„åˆå¼-api"><a href="#_1-ä¸-2-x-ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸå¯¹åº”çš„ç»„åˆå¼-api" class="header-anchor">#</a> 1. ä¸ 2.x ç‰ˆæœ¬ç”Ÿå‘½å‘¨æœŸå¯¹åº”çš„ç»„åˆå¼ API</h3> <ul><li><s><code>beforeCreate</code></s> -&gt; ä½¿ç”¨ <code>setup()</code></li> <li><s><code>created</code></s> -&gt; ä½¿ç”¨ <code>setup()</code></li> <li><code>beforeMount</code> -&gt; <code>onBeforeMount</code></li> <li><code>mounted</code> -&gt; <code>onMounted</code></li> <li><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></li> <li><code>updated</code> -&gt; <code>onUpdated</code></li> <li><code>beforeDestroy</code> -&gt; <code>onBeforeUnmount</code></li> <li><code>destroyed</code> -&gt; <code>onUnmounted</code></li> <li><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></li></ul> <h3 id="_2-æ–°å¢çš„é’©å­å‡½æ•°"><a href="#_2-æ–°å¢çš„é’©å­å‡½æ•°" class="header-anchor">#</a> 2. æ–°å¢çš„é’©å­å‡½æ•°</h3> <p>é™¤äº†å’Œ 2.x ç”Ÿå‘½å‘¨æœŸç­‰æ•ˆé¡¹ä¹‹å¤–ï¼Œç»„åˆå¼ API è¿˜æä¾›äº†ä»¥ä¸‹è°ƒè¯•é’©å­å‡½æ•°ï¼š</p> <ul><li><code>onRenderTracked</code></li> <li><code>onRenderTriggered</code></li></ul> <p>ä¸¤ä¸ªé’©å­å‡½æ•°éƒ½æ¥æ”¶ä¸€ä¸ª <code>DebuggerEvent</code>ï¼Œä¸ <code>watchEffect</code> å‚æ•°é€‰é¡¹ä¸­çš„ <code>onTrack</code> å’Œ <code>onTrigger</code> ç±»ä¼¼ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">onRenderTriggered</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">debugger</span>
    <span class="token comment">// æ£€æŸ¥å“ªä¸ªä¾èµ–æ€§å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="header-anchor">#</a> ä¾èµ–æ³¨å…¥</h2> <p><code>provide</code> å’Œ <code>inject</code> æä¾›ä¾èµ–æ³¨å…¥ï¼ŒåŠŸèƒ½ç±»ä¼¼ 2.x çš„ <code>provide/inject</code>ã€‚ä¸¤è€…éƒ½åªèƒ½åœ¨å½“å‰æ´»åŠ¨ç»„ä»¶å®ä¾‹çš„ <code>setup()</code> å‡½æ•°ä¸­è°ƒç”¨ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> provide<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> ThemeSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> Ancestor <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">provide</span><span class="token punctuation">(</span>ThemeSymbol<span class="token punctuation">,</span> <span class="token string">'dark'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Descendent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>ThemeSymbol<span class="token punctuation">,</span> <span class="token string">'light'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      theme
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>inject</code> æ¥å—ä¸€ä¸ªå¯é€‰çš„é»˜è®¤å€¼ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚å¦‚æœæœªæä¾›é»˜è®¤å€¼ï¼Œå¹¶ä¸”åœ¨ <code>provide</code> ä¸Šä¸‹æ–‡ä¸­æœªæ‰¾åˆ°è¯¥å±æ€§ï¼Œåˆ™ <code>inject</code> è¿”å› <code>undefined</code>ã€‚</p> <h3 id="_1-æ³¨å…¥çš„å“åº”æ€§"><a href="#_1-æ³¨å…¥çš„å“åº”æ€§" class="header-anchor">#</a> 1. æ³¨å…¥çš„å“åº”æ€§</h3> <p>å¯ä»¥ä½¿ç”¨ <code>ref</code> æ¥ä¿è¯ <code>provid</code> å’Œ <code>inject</code> ä¹‹é—´å€¼çš„å“åº”ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æä¾›è€…ï¼š</span>
<span class="token keyword">const</span> themeRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'dark'</span><span class="token punctuation">)</span>
<span class="token function">provide</span><span class="token punctuation">(</span>ThemeSymbol<span class="token punctuation">,</span> themeRef<span class="token punctuation">)</span>

<span class="token comment">// ä½¿ç”¨è€…ï¼š</span>
<span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>ThemeSymbol<span class="token punctuation">,</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">theme set to: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>theme<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>å¦‚æœæ³¨å…¥ä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼Œåˆ™å®ƒçš„çŠ¶æ€å˜åŒ–ä¹Ÿå¯ä»¥è¢«ä¾¦å¬ã€‚</p> <h3 id="_2-ç±»å‹å®šä¹‰"><a href="#_2-ç±»å‹å®šä¹‰" class="header-anchor">#</a> 2. ç±»å‹å®šä¹‰</h3> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">interface</span> <span class="token class-name">InjectionKey<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Symbol</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">provide</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> InjectionKey<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>

<span class="token comment">// æœªä¼ ï¼Œä½¿ç”¨ç¼ºçœå€¼</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> InjectionKey<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span>
<span class="token comment">// ä¼ å…¥äº†é»˜è®¤å€¼</span>
<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> InjectionKey<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">,</span> defaultValue<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span>
</code></pre></div><p>Vue æä¾›äº†ä¸€ä¸ªç»§æ‰¿ <code>Symbol</code> çš„ <code>InjectionKey</code> æ¥å£ã€‚å®ƒå¯ç”¨äºåœ¨æä¾›è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´åŒæ­¥æ³¨å…¥å€¼çš„ç±»å‹ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> InjectionKey<span class="token punctuation">,</span> provide<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> key<span class="token operator">:</span> InjecttionKey<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">provide</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// ç±»å‹ä¸æ˜¯ string ä¼šæŠ¥é”™</span>

<span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token comment">// foo çš„ç±»å‹ï¼šstring | undefined</span>
</code></pre></div><p>å¦‚æœä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºé”®æˆ–æ²¡æœ‰å®šä¹‰ç±»å‹çš„ç¬¦å·ï¼Œåˆ™éœ€è¦æ˜¾å¼åœ°å£°æ˜æ³¨å…¥å€¼çš„ç±»å‹ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token generic-function"><span class="token function">inject</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token comment">// string | undefined</span>
</code></pre></div><h2 id="æ¨¡æ¿-refs"><a href="#æ¨¡æ¿-refs" class="header-anchor">#</a> æ¨¡æ¿ Refs</h2> <p>å½“ä½¿ç”¨ç»„åˆå¼ API æ—¶ï¼Œreactive refs å’Œ template refs çš„æ¦‚å¿µå·²ç»æ˜¯ç»Ÿä¸€çš„ã€‚ä¸ºäº†è·å¾—å¯¹æ¨¡æ¿å†…å…ƒç´ æˆ–ç»„ä»¶å®ä¾‹çš„å¼•ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åƒå¾€å¸¸ä¸€æ ·åœ¨ <code>setup()</code> ä¸­å£°æ˜ä¸€ä¸ª ref å¹¶è¿”å›å®ƒï¼š</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
  
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// åœ¨æ¸²æŸ“å®Œæˆåï¼Œè¿™ä¸ª div DOM ä¼šè¢«èµ‹å€¼ç»™ root ref å¯¹è±¡</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// &lt;div&gt;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span> root <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬å°† <code>root</code> æš´éœ²åœ¨æ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶é€šè¿‡ <code>ref=&quot;root&quot;</code> ç»‘å®šåˆ° <code>div</code> ä½œä¸ºå…¶ <code>ref</code>ã€‚åœ¨ Virtual DOM patch ç®—æ³•ä¸­ï¼Œå¦‚æœä¸€ä¸ª VNode çš„ <code>ref</code> å¯¹åº”ä¸€ä¸ªæ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­çš„ <code>ref</code>ï¼Œåˆ™è¯¥ VNode å¯¹åº”çš„å…ƒç´ æˆ–ç»„ä»¶å®ä¾‹å°†è¢«åˆ†é…ç»™è¯¥ refã€‚è¿™æ˜¯åœ¨ Virtual DOM çš„ mount/patch è¿‡ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå› æ­¤æ¨¡æ¿ ref ä»…åœ¨æ¸²æŸ“åˆå§‹åŒ–åæ‰èƒ½è®¿é—®ã€‚</p> <p>ref è¢«ç”¨åœ¨æ¨¡æ¿ä¸­æ—¶å’Œå…¶ä»– ref ä¸€æ ·ï¼šéƒ½æ˜¯å“åº”å¼çš„ï¼Œå¹¶å¯ä»¥ä¼ é€’è¿›ç»„åˆå‡½æ•°ï¼ˆæˆ–ä»å…¶ä¸­è¿”å›ï¼‰ã€‚</p> <h3 id="_1-é…åˆ-render-jsx"><a href="#_1-é…åˆ-render-jsx" class="header-anchor">#</a> 1. é…åˆ render/JSX</h3> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>
    	<span class="token string">'div'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        ref<span class="token operator">:</span> root
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    
    <span class="token comment">// JSX</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>root<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-v-for-ä¸­ä½¿ç”¨"><a href="#_2-v-for-ä¸­ä½¿ç”¨" class="header-anchor">#</a> 2. v-for ä¸­ä½¿ç”¨</h3> <p>æ¨¡æ¿ ref åœ¨ <code>v-for</code> ä¸­ä½¿ç”¨ vue æ²¡æœ‰åšç‰¹æ®Šå¤„ç†ï¼Œéœ€è¦ä½¿ç”¨å‡½æ•°å‹çš„ refï¼ˆ3.0 æä¾›çš„æ–°åŠŸèƒ½ï¼‰æ¥è‡ªå®šä¹‰å¤„ç†æ–¹å¼ï¼š</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item, i) in list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>el =&gt; { divs[i] = el }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{ item }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> onBeforeUpdate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
  
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> divs <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment">// ç¡®ä¿åœ¨æ¯æ¬¡å˜æ›´ä¹‹å‰é‡ç½®å¼•ç”¨</span>
    <span class="token function">onBeforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      divs<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      list<span class="token punctuation">,</span>
      divs
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="å“åº”å¼ç³»ç»Ÿå·¥å…·é›†"><a href="#å“åº”å¼ç³»ç»Ÿå·¥å…·é›†" class="header-anchor">#</a> å“åº”å¼ç³»ç»Ÿå·¥å…·é›†</h2> <h3 id="_1-unref"><a href="#_1-unref" class="header-anchor">#</a> 1. unref</h3> <p>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ª ref åˆ™è¿”å›å®ƒçš„ <code>value</code>ï¼Œå¦åˆ™è¿”å›å‚æ•°æœ¬èº«ã€‚å®ƒæ˜¯ <code>value = isRef(val) ? val.value ? val</code> çš„è¯­æ³•ç³–ã€‚</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">function</span> <span class="token function">useFoo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token operator">:</span> number <span class="token operator">|</span> Ref<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> unerapped <span class="token operator">=</span> <span class="token function">unref</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token comment">// unwrapped ä¸€å®šæ˜¯ number ç±»å‹</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-toref"><a href="#_2-toref" class="header-anchor">#</a> 2. toRef</h3> <p><code>toRef</code> å¯ä»¥ç”¨æ¥ä¸ºä¸€ä¸ª reactive å¯¹è±¡çš„å±æ€§åˆ›å»ºä¸€ä¸ª refã€‚è¿™ä¸ª ref å¯ä»¥è¢«ä¼ é€’å¹¶ä¸”èƒ½å¤Ÿä¿æŒå“åº”æ€§ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> fooRef <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span>

fooRef<span class="token punctuation">.</span>value<span class="token operator">++</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment">// 2</span>

state<span class="token punctuation">.</span>foo<span class="token operator">++</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fooRef<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre></div><p>å½“æ‚¨è¦å°†ä¸€ä¸ª prop ä¸­çš„å±æ€§ä½œä¸º ref ä¼ é€’ç»™ç»„åˆé€»è¾‘å‡½æ•°æ—¶ï¼Œ<code>toRef</code> å°±æ´¾ä¸Šäº†ç”¨åœºï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">useSomeFeature</span><span class="token punctuation">(</span><span class="token function">toRef</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-torefs"><a href="#_3-torefs" class="header-anchor">#</a> 3. toRefs</h3> <p>æŠŠä¸€ä¸ªå“åº”å¼å¯¹è±¡è½¬æ¢æˆæ™®é€šå¯¹è±¡ï¼Œè¯¥æ™®é€šå¯¹è±¡çš„æ¯ä¸ª property éƒ½æ˜¯ä¸€ä¸ª refï¼Œå’Œå“åº”å¼å¯¹è±¡ property ä¸€ä¸€å¯¹åº”ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> stateAsRefs <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>

<span class="token comment">/*
stateAsRefs çš„ç±»å‹å¦‚ä¸‹:
{
  foo: Ref&lt;number&gt;,
  bar: Ref&lt;number&gt;
}
*/</span>

<span class="token comment">// ref å¯¹è±¡ ä¸ åŸå±æ€§çš„å¼•ç”¨æ˜¯ &quot;é“¾æ¥&quot; ä¸Šçš„</span>
state<span class="token punctuation">.</span>foo<span class="token operator">++</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stateAsRefs<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 2</span>

stateAsRefs<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>value<span class="token operator">++</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token comment">// 3</span>
</code></pre></div><p>æƒ³è¦ä»ä¸€ä¸ªç»„åˆé€»è¾‘å‡½æ•°ä¸­è¿”å›å“åº”å¼å¯¹è±¡æ—¶ï¼Œç”¨ <code>toRefs</code> æ˜¯å¾ˆæœ‰æ•ˆçš„ï¼Œè¯¥ API è®©æ¶ˆè´¹è€…ç»„ä»¶å¯ä»¥ è§£æ„/æ‰©å±•ï¼ˆä½¿ç”¨ <code>...</code> æ“ä½œç¬¦ï¼‰è¿”å›çš„å¯¹è±¡ï¼Œå¹¶ä¸ä¼šä¸¢å¤±å“åº”æ€§ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">useFeatureX</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    bar<span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¯ä»¥è§£æ„ï¼Œä¸”ä¸ä¼šä¸¢å¤±å“åº”æ€§</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> foo<span class="token punctuation">,</span> bar <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFeatureX</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      foo<span class="token punctuation">,</span>
      bar
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-isref"><a href="#_4-isref" class="header-anchor">#</a> 4. isRef</h3> <p>æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºä¸€ä¸ª ref å¯¹è±¡ã€‚</p> <h3 id="_5-isproxy"><a href="#_5-isproxy" class="header-anchor">#</a> 5. isProxy</h3> <p>æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± <code>reactive</code> æˆ–è€… <code>readonly</code> æ–¹æ³•åˆ›å»ºçš„ä»£ç†ã€‚</p> <h3 id="_6-isreactive"><a href="#_6-isreactive" class="header-anchor">#</a> 6. isReactive</h3> <p>æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ç”± <code>reactive</code> åˆ›å»ºçš„å“åº”å¼ä»£ç†ã€‚</p> <p>å¦‚æœè¿™ä¸ªä»£ç†æ˜¯ç”± <code>readonly</code> åˆ›å»ºçš„ï¼Œä½†æ˜¯åˆè¢« <code>reactive</code> åˆ›å»ºçš„å¦ä¸€ä¸ªä»£ç†åŒ…è£¹äº†ä¸€å±‚ï¼Œé‚£ä¹ˆåŒæ ·ä¹Ÿä¼šè¿”å› <code>true</code>ã€‚</p> <h3 id="_7-isreadonly"><a href="#_7-isreadonly" class="header-anchor">#</a> 7. isReadonly</h3> <p>æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± <code>readonly</code> åˆ›å»ºçš„åªè¯»ä»£ç†ã€‚</p> <h2 id="é«˜çº§å“åº”å¼ç³»ç»Ÿ-api"><a href="#é«˜çº§å“åº”å¼ç³»ç»Ÿ-api" class="header-anchor">#</a> é«˜çº§å“åº”å¼ç³»ç»Ÿ API</h2> <h3 id="_1-customref"><a href="#_1-customref" class="header-anchor">#</a> 1. customRef</h3> <p><code>customRef</code> ç”¨äºè‡ªå®šä¹‰ä¸€ä¸ª <code>ref</code>ï¼Œå¯ä»¥æ˜¾å¼åœ°æ§åˆ¶ä»¥æ¥è¿½è¸ªå’Œè§¦å‘å“åº”ï¼Œæ¥å—ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ç”¨äºè¿½è¸ª <code>track</code> ä¸ç”¨äºè§¦å‘å“åº”çš„ <code>trigger</code>ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸¦æœ‰ <code>get</code> å’Œ <code>set</code> å±æ€§çš„å¯¹è±¡ã€‚</p> <ul><li><p>ä½¿ç”¨è‡ªå®šä¹‰ ref å®ç°å¸¦é˜²æŠ–åŠŸèƒ½çš„ <code>v-model</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">function</span> <span class="token function">useDebouncedRef</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">200</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timeout
  <span class="token keyword">return</span> <span class="token function">costomRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track<span class="token punctuation">,</span> trigger</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> value
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span>
        timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          value <span class="token operator">=</span> newValue
          <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>ç±»å‹å®šä¹‰</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">customRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>factory<span class="token operator">:</span> CustomRefFactory<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>

<span class="token keyword">type</span> <span class="token class-name">CustomRefFactory<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token function-variable function">track</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token function-variable function">trigger</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">T</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="_2-markraw"><a href="#_2-markraw" class="header-anchor">#</a> 2. markRaw</h3> <p>æ˜¾å¼æ ‡è®°ä¸€ä¸ªå¯¹è±¡ä¸º â€œæ°¸è¿œä¸ä¼šè½¬ä¸ºå“åº”å¼ä»£ç†â€ï¼Œå‡½æ•°è¿”å›è¿™ä¸ªå¯¹è±¡æœ¬èº«ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">markRaw</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span><span class="token function">reactive</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token comment">// å¦‚æœè¢« markRaw æ ‡è®°äº†ï¼Œå³ä½¿åœ¨å“åº”å¼å¯¹è±¡ä¸­ä½œå±æ€§ï¼Œä¹Ÿä¾ç„¶ä¸æ˜¯å“åº”å¼çš„</span>
<span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo <span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><h3 id="_3-shallowreactive"><a href="#_3-shallowreactive" class="header-anchor">#</a> 3. shallowReactive</h3> <p>åªä¸ºæŸä¸ªå¯¹è±¡çš„ç§æœ‰ï¼ˆç¬¬ä¸€å±‚ï¼‰å±æ€§åˆ›å»ºæµ…å±‚çš„å“åº”å¼ä»£ç†ï¼Œä¸ä¼šå¯¹ â€œå±æ€§çš„å±æ€§â€ åšæ·±å±‚æ¬¡ã€é€’å½’åœ°å“åº”å¼ä»£ç†ï¼Œè€Œåªæ˜¯ä¿ç•™åŸæ ·ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">shallowReactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  nested<span class="token operator">:</span> <span class="token punctuation">{</span>
    bar<span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// å˜æ›´ state çš„è‡ªæœ‰å±æ€§æ˜¯å“åº”å¼çš„</span>
state<span class="token punctuation">.</span>foo<span class="token operator">++</span>
<span class="token comment">// ...ä½†ä¸ä¼šæ·±å±‚ä»£ç†</span>
<span class="token function">isReactive</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>nested<span class="token punctuation">)</span> <span class="token comment">// false</span>
state<span class="token punctuation">.</span>nested<span class="token punctuation">.</span>bar<span class="token operator">++</span> <span class="token comment">// éå“åº”å¼</span>
</code></pre></div><h3 id="_4-shallowreadonly"><a href="#_4-shallowreadonly" class="header-anchor">#</a> 4. shallowReadonly</h3> <p>åªä¸ºæŸä¸ªå¯¹è±¡çš„è‡ªæœ‰ï¼ˆç¬¬ä¸€å±‚ï¼‰å±æ€§åˆ›å»ºæµ…å±‚çš„<strong>åªè¯»</strong>å“åº”å¼ä»£ç†ï¼ŒåŒæ ·ä¹Ÿä¸ä¼šåšæ·±å±‚æ¬¡ã€é€’å½’åœ°ä»£ç†ï¼Œæ·±å±‚æ¬¡çš„å±æ€§å¹¶ä¸æ˜¯åªè¯»çš„ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">shallowReadonly</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  nested<span class="token operator">:</span> <span class="token punctuation">{</span>
    bar<span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// å˜æ›´ state çš„è‡ªæœ‰å±æ€§ä¼šå¤±è´¥</span>
state<span class="token punctuation">.</span>foo<span class="token operator">++</span>
<span class="token comment">// ...ä½†æ˜¯åµŒå¥—çš„å¯¹è±¡æ˜¯å¯ä»¥å˜æ›´çš„</span>
<span class="token function">isReadonly</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>nested<span class="token punctuation">)</span> <span class="token comment">// false</span>
state<span class="token punctuation">.</span>nested<span class="token punctuation">.</span>bar<span class="token operator">++</span> <span class="token comment">// åµŒå¥—å±æ€§ä¾ç„¶å¯ä¿®æ”¹</span>
</code></pre></div><h3 id="_5-shallowref"><a href="#_5-shallowref" class="header-anchor">#</a> 5. shallowRef</h3> <p>åˆ›å»ºä¸€ä¸ª refï¼Œå°†ä¼šè·Ÿè¸ªå®ƒçš„ <code>.value</code> æ›´æ”¹æ“ä½œï¼Œä½†æ˜¯å¹¶ä¸ä¼šçš„å¯¹å˜æ›´åçš„ <code>.value</code> åšå“åº”å¼è½¬æ¢ä»£ç†ï¼ˆå³å˜æ›´ä¸ä¼šè°ƒç”¨ <code>reactive</code>ï¼‰ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">shallowRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// æ›´æ”¹å¯¹æ“ä½œä¼šè§¦å‘å“åº”</span>
foo<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// ä½†ä¸Šé¢æ–°èµ‹çš„è¿™ä¸ªå¯¹è±¡å¹¶ä¸ä¼šå˜ä¸ºå“åº”å¼å¯¹è±¡</span>
<span class="token function">isReactive</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// false</span>
</code></pre></div><h3 id="_6-toraw"><a href="#_6-toraw" class="header-anchor">#</a> 6. toRaw</h3> <p>è¿”å›ç”± <code>reactive</code> æˆ– <code>readonly</code> æ–¹æ³•è½¬æ¢æˆå“åº”å¼ä»£ç†çš„æ™®é€šå¯¹è±¡ã€‚è¿™æ˜¯ä¸€ä¸ªè¿˜åŸæ–¹æ³•ï¼Œå¯ç”¨äºä¸´æ—¶è¯»å–ï¼Œè®¿é—®ä¸ä¼šè¢«ä»£ç†/è·Ÿè¸ªï¼Œå†™å…¥æ—¶ä¹Ÿä¸ä¼šè§¦å‘æ›´æ”¹ã€‚ä¸å»ºè®®ä¸€ç›´æŒæœ‰åŸå§‹å¯¹è±¡çš„å¼•ç”¨ã€‚è¯·è°¨æ…ä½¿ç”¨ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> reactiveFoo <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">toRaw</span><span class="token punctuation">(</span>reactiveFoo<span class="token punctuation">)</span> <span class="token operator">===</span> foo<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/shanyuhai123/documents/edit/master/docs/frontend/vue/vue-composition-api.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘æ–‡æ¡£ï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">2020å¹´11æœˆ20æ—¥æ˜ŸæœŸäº”ä¸‹åˆ3ç‚¹39åˆ†</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/frontend/vue/" class="prev router-link-active">
        Vue
      </a></span> <span class="next"><a href="/frontend/vue/vue3-rfc.html">
        Vue3 RFC
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.f3bc4e43.js" defer></script><script src="/assets/js/2.93d5c1c0.js" defer></script><script src="/assets/js/138.0cbe3cb0.js" defer></script><script src="/assets/js/4.339569f1.js" defer></script>
  </body>
</html>
