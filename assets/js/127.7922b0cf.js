(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{583:function(t,s,a){"use strict";a.r(s);var e=a(29),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),a("p",[t._v("虽然也可以自己写 Shell 实现分发脚本，但由于缺乏运维系统概念，混乱、零碎的写法总是让人难受，一接触到 ansible 就知道很难回去了。")]),t._v(" "),a("p",[t._v("Ansible 是一个用来批量管理部署远程主机上服务的工具，它通过 SSH 协议实现管理节点与远程节点之间的通信，所以首先需要完成 "),a("RouterLink",{attrs:{to:"/os/linux/login-with-rsa-key.html#生成-rsa"}},[t._v("SSH 配置")]),t._v("。")],1),t._v(" "),a("p",[t._v("需要注意的是 Ansible 需要开启公钥认证，也就是添加到 "),a("code",[t._v("known_hosts")]),t._v(" 中，对于大批量的操作可以禁用该行为：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/ansible/ansible.cfg\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改以下内容")]),t._v("\nhost_key_checking "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" False "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 取消注释")]),t._v("\n")])])]),a("h2",{attrs:{id:"install"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install"}},[t._v("#")]),t._v(" install")]),t._v(" "),a("p",[t._v("虽然可以很简单的直接使用 "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#latest-release-via-dnf-or-yum",target:"_blank",rel:"noopener noreferrer"}},[t._v("yum 安装"),a("OutboundLink")],1),t._v("，但由于 ansible 是一个 python 编写的工具，这样就会导致 ansible 依赖于全局的 python，当全局依赖发生变化的时候可能导致 ansible 出现冲突或潜在的安全问题，所以需要隔离 ansible 与其他应用。")]),t._v(" "),a("h3",{attrs:{id:"_1-关闭限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-关闭限制"}},[t._v("#")]),t._v(" 1. 关闭限制")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("systemctl stop firewalld\nsystemctl disable firewalld\nsystemctl status firewalld "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/sysconfig/selinux\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改以下内容")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SELINUX")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("disabled\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reboot")]),t._v("\ngetenforce "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证 Disabled")]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-安装-python"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-安装-python"}},[t._v("#")]),t._v(" 2. 安装 "),a("a",{attrs:{href:"https://www.python.org/downloads/source/",target:"_blank",rel:"noopener noreferrer"}},[t._v("python"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://www.python.org/ftp/python/3.6.9/Python-3.6.9.tar.xz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf Python-3.6.9.tar.xz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" Python-3.6.9\n./configure --prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/local --with-ensurepip"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("install --enable-shared "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("LDFLAGS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-Wl,-rpath /usr/local/lib"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" altinstall\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("which")]),t._v(" pip3.6\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" -s /usr/local/bin/pip3.6 /usr/local/bin/pip "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 建立软连接")]),t._v("\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" virtualenv\n")])])]),a("h3",{attrs:{id:"_3-创建实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建实例"}},[t._v("#")]),t._v(" 3. 创建实例")]),t._v(" "),a("p",[t._v("需要创建一个 ansible 用户，并在该系统用户下创建一个 python3.6 版本的 virtualenv 实例。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useradd")]),t._v(" deploy\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" - deploy\nvirtualenv -p /usr/local/bin/python3.6 .py3-a2.8-env "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 创建实例")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /home/deploy/.py3-a2.8-env/bin/activate\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" paramiko PyYAML  jinja2 "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装依赖，保持顺序")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-安装-ansible"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装-ansible"}},[t._v("#")]),t._v(" 4. 安装 ansible")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html#latest-release-via-dnf-or-yum",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),a("OutboundLink")],1),t._v("推荐的安装方式，当下载速度极慢时的"),a("RouterLink",{attrs:{to:"/tools/github/download-huge-project-from-github.html"}},[t._v("解决方案")]),t._v("。")],1),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://gitee.com/shanyuhai123/ansible.git\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" ansible .py3-a2.8-env/\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" .py3-a2.8-env/ansible\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" branch -a "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看分支")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout stable-2.8\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" /home/deploy/.py3-a2.8-env/ansible/hacking/env-setup -q\nansible --version "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n")])])]),a("h3",{attrs:{id:"_5-启用-ansible"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-启用-ansible"}},[t._v("#")]),t._v(" 5. 启用 ansible")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),t._v(" -r now "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" - deploy\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" .py3-a2.8-env/bin/activate "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载 py3")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("source")]),t._v(" .py3-a2.8-env/ansible/hacking/env-setup -q "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 加载 ansible")]),t._v("\nansible --version "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n")])])]),a("h2",{attrs:{id:"inventory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#inventory"}},[t._v("#")]),t._v(" inventory")]),t._v(" "),a("p",[t._v("Ansible 可同事操作属于一个组的多台主机，组和主机之间的关系通过 "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("inventory"),a("OutboundLink")],1),t._v(" 文件配置。默认的文件路径为 "),a("code",[t._v("/etc/ansible/hosts")]),t._v("，除默认文件外，还可以使用多个 inventory 文件，当然也可以从云上拉取配置信息。")]),t._v(" "),a("h3",{attrs:{id:"_1-ini-like"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-ini-like"}},[t._v("#")]),t._v(" 1. INI-like")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("mail.example.com\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("t1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.11\n"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.12\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nwww"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("01:50"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".example.com\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ndb-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("a:f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(".example.com\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("webservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nfoo.example.com\nbar.example.com\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dbservers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\none.example.com\ntwo.example.com\nthree.example.com:5309\n")])])]),a("h3",{attrs:{id:"_2-yaml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-yaml"}},[t._v("#")]),t._v(" 2. YAML")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mail.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("webservers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("foo.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("bar.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dbservers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("one.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("two.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("three.example.com")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-inheriting-variable-values"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-inheriting-variable-values"}},[t._v("#")]),t._v(" 3. Inheriting variable values")]),t._v(" "),a("p",[t._v("在这种情况下自己书写规则 INI-like 风格更方便一些，但是接手他人的时候更希望看到 YAML 风格，更一目了然。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("INI-like")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("atlanta"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nhost1\nhost2\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("raleigh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nhost2\nhost3\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("southeast:children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\natlanta\nraleigh\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("southeast:vars"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("some_server")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("foo.southeast.example.com\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("halon_system_timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("self_destruct_countdown")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("escape_pods")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("usa:children"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nsoutheast\nnortheast\nsouthwest\nnorthwest\n")])])])]),t._v(" "),a("li",[a("p",[t._v("YAML")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("all")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("usa")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("southeast")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("atlanta")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("raleigh")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("vars")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("some_server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" foo.southeast.example.com\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("halon_system_timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("self_destruct_countdown")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("escape_pods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("northeast")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("northwest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("southwest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])])])])]),t._v(" "),a("h3",{attrs:{id:"_4-参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-参数"}},[t._v("#")]),t._v(" 4. 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("参数")]),t._v(" "),a("th",[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_connection")]),t._v(" "),a("td",[t._v("连接类型到主机。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_host")]),t._v(" "),a("td",[t._v("要连接的主机的名称。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_port")]),t._v(" "),a("td",[t._v("连接端口号。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_user")]),t._v(" "),a("td",[t._v("连接到主机时要使用的用户名。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_password")]),t._v(" "),a("td",[t._v("身份验证的密码。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_ssh_private_key_file")]),t._v(" "),a("td",[t._v("ssh使用的私钥文件。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_ssh_common_args")]),t._v(" "),a("td",[t._v("此设置始终附加到sftp，scp和ssh的默认命令行。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_sftp_extra_args")]),t._v(" "),a("td",[t._v("此设置始终附加到默认的sftp命令行。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_scp_extra_args")]),t._v(" "),a("td",[t._v("此设置始终附加到默认scp命令行。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_ssh_extra_args")]),t._v(" "),a("td",[t._v("此设置始终附加到默认的ssh命令行。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_ssh_pipelining")]),t._v(" "),a("td",[t._v("确定是否使用SSH流水线。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_ssh_executable")]),t._v(" "),a("td",[t._v("此设置将覆盖使用系统ssh的默认行为。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_shell_type")]),t._v(" "),a("td",[t._v("目标系统的shell类型。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("ansible_python_interpreter")]),t._v(" "),a("td",[t._v("目标主机python路径。")])])])]),t._v(" "),a("h2",{attrs:{id:"ad-hoc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ad-hoc"}},[t._v("#")]),t._v(" ad-hoc")]),t._v(" "),a("p",[t._v("ad-hoc 可以帮助完成临时任务，很多时候并不需要 Ansible 的强大力量（playbook）。")]),t._v(" "),a("p",[t._v("命令格式：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ansible "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pattern_goes_here"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -m "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("module_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("arguments"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("仅列出部分示例。")]),t._v(" "),a("h3",{attrs:{id:"_1-command"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-command"}},[t._v("#")]),t._v(" 1. "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/command_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("command"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Execute "),a("strong",[t._v("command")]),t._v("s on targets。")]),t._v(" "),a("p",[t._v("实践：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ansible t1 -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"free -m"')]),t._v("\nansible t1 -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"df -h"')]),t._v("\nansible t1 -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ls /root"')]),t._v("\nansible t1 -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cat redhat-release"')]),t._v("\n")])])]),a("h3",{attrs:{id:"_2-shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-shell"}},[t._v("#")]),t._v(" 2. "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/shell_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("shell"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Execute shell commands on targets。")]),t._v(" "),a("p",[t._v("实践：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ansible t1 -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo hello > /tmp/tmp.txt"')]),t._v("\nansible t1 -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cat /tmp/tmp.txt"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n")])])]),a("h3",{attrs:{id:"_3-copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-copy"}},[t._v("#")]),t._v(" 3. "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/copy_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("copy"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Copy files to remote locations。")]),t._v(" "),a("p",[t._v("实践：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ansible t1 -m copy -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src=/root/shell dest=/tmp"')]),t._v("\nansible t1 -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ls /tmp"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\nansible t1 -m shell -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wc -l /tmp/shell"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-script"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-script"}},[t._v("#")]),t._v(" 4. "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/script_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("script"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Runs a local script on a remote node after transferring it。")]),t._v(" "),a("p",[t._v("实践：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo hello"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /tmp/hello.sh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /tmp/hello.sh "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\nansible t1 -m script -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/tmp/hello.sh"')]),t._v(" \n")])])]),a("h3",{attrs:{id:"_5-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-file"}},[t._v("#")]),t._v(" 5. "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/file_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("file"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Manage files and file properties。")]),t._v(" "),a("h3",{attrs:{id:"_6-yum"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-yum"}},[t._v("#")]),t._v(" 6. "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/yum_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("yum"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Manages packages with the yum package manager。")]),t._v(" "),a("p",[t._v("实践：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ansible webservers -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"free -m"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n\nansible webservers -m yum -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=nginx state=installed"')]),t._v("\nansible webservers -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx -v"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证 nginx version: nginx/1.12.2")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以注意到并非是最新版 nginx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 参照示例 https://docs.shanyuhai.top/os/centos/install-the-latest-version-of-nginx.html")]),t._v("\nansible webservers -m yum -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=yum-utils state=installed"')]),t._v("\nansible webservers -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ll /etc/yum.repos.d/nginx.repo"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/yum.repos.d/nginx.repo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/yum.repos.d/nginx.repo "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 追加内容参考示例")]),t._v("\nansible webservers -m copy -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src=/etc/yum.repos.d/nginx.repo dest=/etc/yum.repos.d/nginx.repo"')]),t._v("\nansible webservers -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cat /etc/yum.repos.d/nginx.repo"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\nansible webservers -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yum-config-manager --enable nginx-mainline"')]),t._v("\nansible webservers -m yum -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=nginx state=installed"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 更新")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# installed 测试时未能更新，可能需要 present 参数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不推荐使用 yum 卸载")]),t._v("\nansible webservers -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx -v"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证 ")]),t._v("\n")])])]),a("h3",{attrs:{id:"_7-systemd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-systemd"}},[t._v("#")]),t._v(" 7. "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/systemd_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("systemd"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Manage services。")]),t._v(" "),a("p",[t._v("实践：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最好将服务写完整")]),t._v("\nansible t1 -m systemd -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name=crond.service  enabled=yes state=started"')]),t._v("\nansible t1 -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"systemctl status crond"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n")])])]),a("h3",{attrs:{id:"_8-cron"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-cron"}},[t._v("#")]),t._v(" 8. "),a("a",{attrs:{href:"https://docs.ansible.com/ansible/latest/modules/cron_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("cron"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Manage cron.d and crontab entries。")]),t._v(" "),a("p",[t._v("实践：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ansible webservers -m "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cron")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"name='sync time' minute=00 hour=00 job='/usr/sbin/ntpdate time.nist.gov > /dev/null 2>&1'\"")]),t._v(" \nansible webservers -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crontab -l"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除任务")]),t._v("\nansible webservers -m "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cron")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"name='sync time' state=absent\"")]),t._v(" \nansible webservers -m "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" -a "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crontab -l"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证")]),t._v("\n")])])]),a("h2",{attrs:{id:"playbooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#playbooks"}},[t._v("#")]),t._v(" playbooks")]),t._v(" "),a("p",[t._v("相对于 ad-hoc，playbooks 则强大的多，当然也复杂得多。playbook 由一个或多个 plays 组成，在 play 中，一组机器被映射为定义好的角色，其内容被称为 tasks（任务），在基本层次的应用中，一个任务是一个对 ansible 模块的调用。")]),t._v(" "),a("p",[t._v("对于如何良好的实践这些内容，有一些整套的 "),a("a",{attrs:{href:"https://github.com/ansible/ansible-examples",target:"_blank",rel:"noopener noreferrer"}},[t._v("playbooks"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_1-one-play"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-one-play"}},[t._v("#")]),t._v(" 1. one play")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webservers\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("vars")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http_port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max_clients")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ensure apache is at the latest version\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" write the apache config file\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /srv/httpd.j2\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/httpd.conf\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("notify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" restart apache\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ensure apache is running\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" started\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" restart apache\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" restarted\n")])])]),a("h3",{attrs:{id:"_2-multiple-plays"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-multiple-plays"}},[t._v("#")]),t._v(" 2. multiple plays")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webservers\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ensure apache is at the latest version\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" httpd\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" write the apache config file\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /srv/httpd.j2\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /etc/httpd.conf\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" databases\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("remote_user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" root\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tasks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ensure postgresql is at the latest version\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("yum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" postgresql\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" latest\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ensure that postgresql is started\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" postgresql\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("state")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" started\n")])])]),a("h3",{attrs:{id:"_3-directory-layout"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-directory-layout"}},[t._v("#")]),t._v(" 3. Directory Layout")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("production                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# inventory file for production servers")]),t._v("\nstaging                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# inventory file for staging environment")]),t._v("\n\ngroup_vars/\n   group1.yml             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# here we assign variables to particular groups")]),t._v("\n   group2.yml\nhost_vars/\n   hostname1.yml          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# here we assign variables to particular systems")]),t._v("\n   hostname2.yml\n\nlibrary/                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if any custom modules, put them here (optional)")]),t._v("\nmodule_utils/             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if any custom module_utils to support modules, put them here (optional)")]),t._v("\nfilter_plugins/           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# if any custom filter plugins, put them here (optional)")]),t._v("\n\nsite.yml                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# master playbook")]),t._v("\nwebservers.yml            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# playbook for webserver tier")]),t._v("\ndbservers.yml             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# playbook for dbserver tier")]),t._v("\n\nroles/\n    common/               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# this hierarchy represents a "role"')]),t._v("\n        tasks/            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n            main.yml      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <-- tasks file can include smaller files if warranted")]),t._v("\n        handlers/         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n            main.yml      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <-- handlers file")]),t._v("\n        templates/        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <-- files for use with the template resource")]),t._v("\n            ntp.conf.j2   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <------- templates end in .j2")]),t._v("\n        files/            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n            bar.txt       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <-- files for use with the copy resource")]),t._v("\n            foo.sh        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <-- script files for use with the script resource")]),t._v("\n        vars/             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n            main.yml      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <-- variables associated with this role")]),t._v("\n        defaults/         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n            main.yml      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <-- default lower priority variables for this role")]),t._v("\n        meta/             "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n            main.yml      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  <-- role dependencies")]),t._v("\n        library/          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# roles can also include custom modules")]),t._v("\n        module_utils/     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# roles can also include custom module_utils")]),t._v("\n        lookup_plugins/   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or other types of plugins, like lookup in this case")]),t._v("\n\n    webtier/              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# same kind of structure as "common" was above, done for the webtier role')]),t._v("\n    monitoring/           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ""')]),t._v("\n    fooapp/               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# ""')]),t._v("\n")])])]),a("p",[t._v("备用方案：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("inventories/\n   production/\n      hosts               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# inventory file for production servers")]),t._v("\n      group_vars/\n         group1.yml       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# here we assign variables to particular groups")]),t._v("\n         group2.yml\n      host_vars/\n         hostname1.yml    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# here we assign variables to particular systems")]),t._v("\n         hostname2.yml\n\n   staging/\n      hosts               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# inventory file for staging environment")]),t._v("\n      group_vars/\n         group1.yml       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# here we assign variables to particular groups")]),t._v("\n         group2.yml\n      host_vars/\n         stagehost1.yml   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# here we assign variables to particular systems")]),t._v("\n         stagehost2.yml\n\nlibrary/\nmodule_utils/\nfilter_plugins/\n\nsite.yml\nwebservers.yml\ndbservers.yml\n\nroles/\n    common/\n    webtier/\n    monitoring/\n    fooapp/\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);