(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{473:function(a,t,s){"use strict";s.r(t);var e=s(29),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[a._v("#")]),a._v(" 概念")]),a._v(" "),s("p",[a._v("在生产环境中使用 Docker，往往需要对数据进行持久化，或者需要在多个容器之间进行数据共享。\n容器中的数据管理方式有两种：")]),a._v(" "),s("ol",[s("li",[a._v("数据卷（Data Volumes）：容器内数据直接映射到本地主机环境")]),a._v(" "),s("li",[a._v("数据卷容器（Data Volumes Containers）：使用特定容器维护数据卷")])]),a._v(" "),s("h2",{attrs:{id:"数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷"}},[a._v("#")]),a._v(" 数据卷")]),a._v(" "),s("p",[a._v("数据卷是一个可供容器使用的特殊目录，它将主机目录直接映射进容器，类似于 Linux 中的 mount 行为。\n数据卷提供了一些特性：")]),a._v(" "),s("ol",[s("li",[a._v("数据卷可以在容器之间共享和重用，容器间传递数据将变得高效与方便")]),a._v(" "),s("li",[a._v("对数据卷内数据的修改会立即生效，无论容器内操作还是主机操作")]),a._v(" "),s("li",[a._v("对数据卷的更新不会影响镜像，解耦开应用和数据")]),a._v(" "),s("li",[a._v("卷会一直存在，知道没有容器使用，可以安全地卸载它")])]),a._v(" "),s("h3",{attrs:{id:"_1-操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-操作"}},[a._v("#")]),a._v(" 1. 操作")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# docker volume create [OPTIONS] [VOLUME]")]),a._v("\ndocker volume create hello\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 绑定")]),a._v("\ndocker run -d -P --name web --mount "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("type")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("bind,source"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/webapp,destination"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/opt/webapp training/webapp python app.py\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 等价于，个人更倾向于下面的形式")]),a._v("\ndocker run -d -P --name web -v /webapp:/opt/webapp training/webapp python app.py\n")])])]),s("h2",{attrs:{id:"数据卷容器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据卷容器"}},[a._v("#")]),a._v(" 数据卷容器")]),a._v(" "),s("p",[a._v("数据卷容器也是一个容器，但它的目的是专门提供数据卷给其他容器挂载。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建数据卷容器")]),a._v("\ndocker run -it -v /dbdata --name dbdata ubuntu\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 接着可以在其他容器中挂载数据卷")]),a._v("\ndocker run -it --volumes-from dbdata --name db1 ubuntu\ndocker run -it --volumes-from dbdata --name db2 ubuntu\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用 --volumes-from 挂载的数据卷容器自身不需要保持运行状态")]),a._v("\n")])])]),s("h3",{attrs:{id:"_1-迁移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-迁移"}},[a._v("#")]),a._v(" 1. 迁移")]),a._v(" "),s("p",[a._v("可以利用数据卷容器对其中的数据卷进行备份、恢复，以实现数据的迁移。")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("备份")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker run --volumes-from dbdata -v "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/backup --name worker ubuntu "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" cvf /backup/backup.tar /dbdata\n")])])]),s("p",[a._v("首先利用 ubuntu 创建了一个容器 "),s("code",[a._v("worker")]),a._v("，使用 "),s("code",[a._v("--volumes-from dbdata")]),a._v(" 让 "),s("code",[a._v("worker")]),a._v(" 挂载 "),s("code",[a._v("dbdata")]),a._v(" 容器的数据卷；再使用 "),s("code",[a._v("-v $(pwd):/backup")]),a._v(" 来挂载主机的当前目录到 "),s("code",[a._v("worker")]),a._v(" 容器的 "),s("code",[a._v("/backup")]),a._v(" 目录；"),s("code",[a._v("worker")]),a._v(" 容器启动后利用 "),s("code",[a._v("tar cvf /backup/backup.tar /dbdata")]),a._v(" 将 "),s("code",[a._v("/dbdata")]),a._v(" 下的内容打包到 "),s("code",[a._v("/backup/backup.tar")]),a._v("，即主机当前目录下的 "),s("code",[a._v("backup.tar")]),a._v("。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 验证主机环境")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看映射出来的打包文件")]),a._v("\nll \n\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" shanyuhai shanyuhai  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" Jul "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),a._v(" 05:41 ./\ndrwxr-xr-x "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v(" root      root       "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" Jun  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" 01:46 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/\n-rw-r--r-- "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" root      root      "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10240")]),a._v(" Jul "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),a._v(" 05:46 backup.tar\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解压")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" -xvf backup.tar\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看解压文件")]),a._v("\ntree dbdata/\n\ndbdata/\n├── "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("test")]),a._v("\n└── test1\n")])])])]),a._v(" "),s("li",[s("p",[a._v("恢复")]),a._v(" "),s("p",[a._v("首先与之前一般创建一个数据卷容器。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker run -v /dbdata --name dbdata2 ubuntu /bin/bash\n")])])]),s("p",[a._v("接着就可以挂载数据卷容器，并解压备份文件到所挂载的容器卷中。")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("docker run --volumes-from dbdata2 -v "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("pwd")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(":/backup busybox "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xvf /backup/backup.tar\n")])])])])])])}),[],!1,null,null,null);t.default=r.exports}}]);