import{r as t,c as p,a as s,b as n,w as d,F as l,d as a,e,o as i}from"./app.d7f6ba63.js";import{_ as h}from"./plugin-vue_export-helper.5a098b48.js";const r={},u=s("h1",{id:"ssh-\u8BA9\u4F60\u7684\u670D\u52A1\u5668\u66F4\u5B89\u5168",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ssh-\u8BA9\u4F60\u7684\u670D\u52A1\u5668\u66F4\u5B89\u5168","aria-hidden":"true"},"#"),a(" SSH \u8BA9\u4F60\u7684\u670D\u52A1\u5668\u66F4\u5B89\u5168")],-1),m=s("p",null,"\u5B89\u5168\u662F\u76F8\u5BF9\u800C\u8A00\u7684\uFF0C\u6B63\u5728\u4E0D\u65AD\u63A2\u7D22\u4E2D\u3002",-1),k=s("h2",{id:"ssh-\u67B6\u6784",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#ssh-\u67B6\u6784","aria-hidden":"true"},"#"),a(" SSH \u67B6\u6784")],-1),_={href:"https://en.wikipedia.org/wiki/Secure_Shell_Protocol",target:"_blank",rel:"noopener noreferrer"},g=s("strong",null,"Secure Shell Protocol",-1),b=a(" ("),f=s("strong",null,"SSH",-1),x=a(")"),v=a(" \u5206\u4E3A\u4E24\u4E2A\u90E8\u5206\uFF0C\u9ED8\u8BA4\u5B89\u88C5\uFF1A"),y=e(`<ul><li>\u5BA2\u6237\u7AEF(ssh)\uFF1A\u5168\u5C40\u914D\u7F6E\u8DEF\u5F84\u4E3A <code>/etc/ssh/ssh_config</code>\uFF0C\u5F53\u524D\u7528\u6237\u4E3A <code>~/.ssh</code>\u3002</li><li>\u670D\u52A1\u7AEF(sshd)\uFF1A\u5168\u5C40\u914D\u7F6E\u8DEF\u5F84\u4E3A <code>/etc/ssh/sshd_config</code>\uFF0C\u4EE5\u53CA\u5BF9\u5E94\u7528\u6237\u7684 <code>~/.ssh/authorized_keys</code>\u3002</li></ul><h3 id="\u5BA2\u6237\u7AEF" tabindex="-1"><a class="header-anchor" href="#\u5BA2\u6237\u7AEF" aria-hidden="true">#</a> \u5BA2\u6237\u7AEF</h3><p>\u8BBF\u95EE\u670D\u52A1\u5668\uFF0C\u7B2C\u4E00\u6B21\u8BBF\u95EE\u670D\u52A1\u5668\u4F1A\u51FA\u73B0\u8BA4\u8BC1\u63D0\u793A\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># user \u4E3A\u7528\u6237\u540D</span>
<span class="token comment"># hostname \u4E3A\u4E3B\u673A\u540D\uFF08\u57DF\u540D\u3001IP\uFF09</span>
<span class="token function">ssh</span> user@hostname
</code></pre></div><p>\u4E5F\u53EF\u4EE5\u5FEB\u901F\u6267\u884C\u670D\u52A1\u5668\u547D\u4EE4\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u6267\u884C ls</span>
<span class="token function">ssh</span> user@hostname <span class="token function">ls</span> -al

<span class="token comment"># \u4EA4\u4E92\u5F0F\u9700\u6DFB\u52A0 -t</span>
<span class="token function">ssh</span> -t user@hostname <span class="token function">vim</span> xxx.conf
</code></pre></div><h3 id="\u5BA2\u6237\u7AEF\u751F\u6210-ssh-key" tabindex="-1"><a class="header-anchor" href="#\u5BA2\u6237\u7AEF\u751F\u6210-ssh-key" aria-hidden="true">#</a> \u5BA2\u6237\u7AEF\u751F\u6210 SSH Key</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 1. \u5229\u7528\u90AE\u7BB1\u751F\u6210 ssh key</span>
ssh-keygen -t rsa -b <span class="token number">4096</span> -C <span class="token string">&quot;your_email@example.com&quot;</span>
<span class="token comment"># 2. \u8F93\u5165 rsa \u6587\u4EF6\u540D, \u9ED8\u8BA4\u4E3A id_rsa</span>
Enter a <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/home/you/.ssh/id_rsa<span class="token punctuation">)</span>: <span class="token punctuation">[</span>Press enter<span class="token punctuation">]</span> <span class="token comment"># id_rsa_new</span>
<span class="token comment"># 3. \u8F93\u5165\u5BC6\u7801\u77ED\u8BED\uFF08\u65E0\u5BC6\u7801\u77ED\u8BED\u4E3A\u7A7A\uFF09</span>
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>: <span class="token punctuation">[</span>Type a passphrase<span class="token punctuation">]</span>
Enter same passphrase again: <span class="token punctuation">[</span>Type passphrase again<span class="token punctuation">]</span>

<span class="token comment"># 4. \u5FEB\u901F\u751F\u6210 ssh key</span>
ssh-keygen -f ~/.ssh/id_rsa  -P <span class="token string">&#39;&#39;</span> -q <span class="token comment"># \u53EF\u4FEE\u6539\u6587\u4EF6\u540D\uFF0C\u8FD8\u53EF\u63A5\u7EED\u4E0A\u9762\u7684\u914D\u7F6E</span>
</code></pre></div><p>\u518D\u9700\u8981\u5C06\u751F\u6210\u7684\u5BC6\u94A5\u5BF9\u7684\u516C\u94A5\u4E0A\u4F20\u5230\u670D\u52A1\u5668\uFF0C\u867D\u7136\u53EF\u4EE5\u624B\u52A8\u4E0A\u4F20\uFF08FTP\u3001VIM\uFF09\uFF0C\u4F46\u4F7F\u7528 SSH \u63D0\u4F9B\u7684\u5DE5\u5177\u66F4\u4E3A\u8F7B\u677E\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># -i \u6307\u5B9A\u516C\u94A5\uFF0C\u53EF\u5FFD\u7565 \`.pub\` \u540E\u7F00</span>
ssh-copy-id -i id_rsa_name.pub user@hostname
</code></pre></div><p>\u518D\u6B21\u767B\u5F55\u670D\u52A1\u5668\u65F6\u5C31\u4F1A\u53D1\u73B0\u4E0D\u9700\u8981\u8F93\u5165\u5E10\u53F7\u5BC6\u7801\u4E86\u3002</p><h3 id="\u5BA2\u6237\u7AEF\u7684\u5FEB\u901F\u8BBF\u95EE" tabindex="-1"><a class="header-anchor" href="#\u5BA2\u6237\u7AEF\u7684\u5FEB\u901F\u8BBF\u95EE" aria-hidden="true">#</a> \u5BA2\u6237\u7AEF\u7684\u5FEB\u901F\u8BBF\u95EE</h3><p>\u603B\u662F\u6307\u5B9A\u7528\u6237\u3001\u670D\u52A1\u5668\u5730\u5740\u3001\u5BC6\u94A5\u662F\u4E00\u4EF6\u9EBB\u70E6\u7684\u4E8B\u60C5\uFF0C\u53EF\u4EE5\u5199\u5728\u914D\u7F6E\u6587\u4EF6\u4E2D\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u7F16\u8F91 config \u6587\u4EF6</span>
<span class="token function">vim</span> ~/.ssh/config

<span class="token comment"># \u5728 config \u6587\u4EF6\u672B\u5C3E\u8FFD\u52A0\u5185\u5BB9</span>
Host aliyun <span class="token comment"># \u4E00\u4E2A\u4FBF\u4E8E\u4F60\u533A\u522B\u8FD9\u662F\u54EA\u53F0\u673A\u5668\u7684\u540D\u5B57</span>
    HostName xxx.xxx.xxx.xxx <span class="token comment"># \u76EE\u7684\u673A\u5668\u7684 ip</span>
    User root        <span class="token comment"># ssh \u767B\u9646\u65F6\u5019\u7684\u7528\u6237\u540D</span>
    Port <span class="token number">22</span>          <span class="token comment"># ssh \u6240\u4F7F\u7528\u7684\u7AEF\u53E3\uFF0C\u9ED8\u8BA4\u662F 22</span>
    IdentityFile /home/yuan/.ssh/id_rsa_new <span class="token comment"># \u5BF9\u5E94\u670D\u52A1\u5668\u516C\u94A5\u7684\u672C\u5730\u79C1\u94A5\u6587\u4EF6\u8DEF\u5F84</span>
</code></pre></div><p>\u5FEB\u901F\u8BBF\u95EE\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">ssh</span> aliyun
</code></pre></div><h2 id="\u52A0\u56FA\u670D\u52A1\u5668\u7684\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#\u52A0\u56FA\u670D\u52A1\u5668\u7684\u64CD\u4F5C" aria-hidden="true">#</a> \u52A0\u56FA\u670D\u52A1\u5668\u7684\u64CD\u4F5C</h2><p>\u8FD9\u90E8\u5206\u4E3B\u8981\u662F\u5BF9\u670D\u52A1\u5668\u7AEF <code>/etc/ssh/sshd_config</code> \u8FDB\u884C\u4FEE\u6539\uFF0C\u4FEE\u6539\u5B8C\u6210\u540E\u8BB0\u5F97\u91CD\u542F <code>sshd</code> \u670D\u52A1\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>systemctl restart sshd
</code></pre></div><h3 id="\u57FA\u7840\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#\u57FA\u7840\u64CD\u4F5C" aria-hidden="true">#</a> \u57FA\u7840\u64CD\u4F5C</h3><ol><li>\u4FEE\u6539\u9ED8\u8BA4\u7684 sshd \u7AEF\u53E3\uFF0C<code>Port</code></li><li>\u7981\u7528\u5BC6\u7801\u767B\u5F55\uFF0C<code>PasswordAuthentication</code></li><li>\u7981\u6B62\u7A7A\u5BC6\u7801\uFF0C<code>PermitEmptyPasswords</code></li><li>\u7981\u7528 root\uFF0C<code>PermitRootLogin</code></li><li>\u767B\u5F55\u7528\u6237\u767D\u540D\u5355\uFF08\u591A\u4E2A\u7528\u6237\u4E4B\u95F4\u6DFB\u52A0\u7A7A\u683C\uFF09\uFF0C<code>AllowUsers</code></li><li>\u767B\u5F55\u7528\u6237\u7EC4\u767D\u540D\u5355\uFF1A<code>AllowGroups</code></li></ol><p>\u4FEE\u6539\u5B8C\u914D\u7F6E\u540E\u8FDB\u884C\u9A8C\u8BC1\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>sshd -t
</code></pre></div><h3 id="ssh-\u96A7\u9053" tabindex="-1"><a class="header-anchor" href="#ssh-\u96A7\u9053" aria-hidden="true">#</a> SSH \u96A7\u9053</h3>`,24),S=a("\u53EF\u4EE5\u4F7F\u7528 SSH \u96A7\u9053\uFF08SSH Tunnel\uFF09\u7684"),w={href:"https://en.wikipedia.org/wiki/Port_forwarding",target:"_blank",rel:"noopener noreferrer"},P=a("\u8F6C\u53D1\u6A21\u5F0F"),L=a("\u6709\u4E09\u79CD\uFF1A"),H=e(`<ul><li>\u672C\u5730\u7AEF\u53E3\u8F6C\u53D1\uFF08Local port forwarding\uFF09</li><li>\u8FDC\u7A0B\u7AEF\u53E3\u8F6C\u53D1\uFF08Remote port forwarding\uFF09</li><li>\u52A8\u6001\u7AEF\u53E3\u8F6C\u53D1\uFF08Dynamic port forwarding\uFF09</li></ul><p>\u6211\u4EEC\u9700\u8981\u5728\u672C\u5730\u8BBF\u95EE\u90E8\u7F72\u5728\u670D\u52A1\u5668\u4E0A\u7684\u670D\u52A1\uFF0C\u9009\u62E9\u672C\u5730\u7AEF\u53E3\u8F6C\u53D1\u5373\u53EF\u3002\u4F8B\u5982\u5728\u670D\u52A1\u5668\u7684 30000 \u7AEF\u53E3\u90E8\u7F72\u4E86 Web \u670D\u52A1\u3002</p><p>\u53EF\u901A\u8FC7 <code>man ssh</code> \u67E5\u770B\u8BED\u6CD5\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code>-L <span class="token punctuation">[</span>bind_address:<span class="token punctuation">]</span>port:host:hostport
-L <span class="token punctuation">[</span>bind_address:<span class="token punctuation">]</span>port:remote_socket
-L local_socket:host:hostport
-L local_socket:remote_socket
</code></pre></div><p>\u9009\u62E9\u7B2C\u4E00\u79CD\uFF0C<code>ip + port</code> \u7684\u5F62\u5F0F\u5373\u53EF\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u5C06\u670D\u52A1\u5668\u4E0A 30000 \u7AEF\u53E3\u8F6C\u53D1\u5230\u672C\u5730\u7684 8080\uFF0C\u6253\u5F00\u6D4F\u89C8\u5668\u5373\u53EF\u9A8C\u8BC1</span>
<span class="token comment"># -N \u8868\u793A\u4E0D\u767B\u5F55\u670D\u52A1\u5668\uFF0C\u4EC5\u8F6C\u53D1\u7AEF\u53E3</span>
<span class="token function">ssh</span> -L localhost:8080:localhost:30000 user@hostname -N
</code></pre></div><p>\u5F53 <code>bind_address</code> \u7701\u7565\u65F6\uFF0C\u8868\u793A\u7ED1\u81F3\u6240\u6709\u7F51\u5361\u3002\u5728\u8FDC\u7A0B\u6211\u4EEC\u540C\u6837\u4F7F\u7528 <code>localhost</code> \u6307\u5B9A\u4E3A\u670D\u52A1\u5668\u4E3B\u673A\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u4F7F\u7528\u5BF9\u5E94\u7684 IP \u8FDB\u884C\u66FF\u6362\uFF0C\u5982\u679C\u5728\u5C40\u57DF\u7F51\u5185\uFF0C\u4E5F\u53EF\u6307\u5B9A\u4E3A\u5C40\u57DF\u7F51\u5185\u5176\u4ED6\u670D\u52A1\u5668\u7684 IP \u5730\u5740\uFF0C\u4F8B\u5982\u5728 <code>172.21.0.2</code> \u4E0A\uFF1A</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># \u5C06\u670D\u52A1\u5668\u4E0A 80 \u7AEF\u53E3\u8F6C\u53D1\u5230\u672C\u5730\u7684 8080\uFF0C\u6253\u5F00\u6D4F\u89C8\u5668\u5373\u53EF\u9A8C\u8BC1</span>
<span class="token function">ssh</span> -L localhost:8080:172.21.0.2:80 user@hostname -N
</code></pre></div><h3 id="\u670D\u52A1\u8BA4\u8BC1" tabindex="-1"><a class="header-anchor" href="#\u670D\u52A1\u8BA4\u8BC1" aria-hidden="true">#</a> \u670D\u52A1\u8BA4\u8BC1</h3><p>\u8FD9\u4E00\u90E8\u5206\u5B9E\u9645\u4E0A\u662F Nginx \u7684\u5185\u5BB9\uFF0C\u5728\u6784\u5EFA\u4E86\u4E00\u4E9B\u5F00\u6E90\u670D\u52A1\u65F6\uFF0C\u5373\u4F7F\u4F60\u5728\u7528\u6237\u8BA4\u8BC1\u4E0A\u505A\u4E86\u5145\u8DB3\u7684\u51C6\u5907\uFF0C\u4F46\u8F6F\u4EF6\u662F\u4EBA\u5199\u7684\u603B\u662F\u5B58\u5728\u6F0F\u6D1E\uFF0C\u53EF\u4EE5\u6DFB\u52A0 <code>Basic Auth</code> \u53CA <code>IP \u767D\u540D\u5355</code> \u8FDB\u884C\u8BBF\u95EE\u3002</p><h3 id="fail2ban" tabindex="-1"><a class="header-anchor" href="#fail2ban" aria-hidden="true">#</a> fail2ban</h3>`,11),N=a("\u5982\u679C\u6709\u9ED1\u5BA2\u6301\u7EED\u7206\u7834\u4F60\u7684\u670D\u52A1\u5668\uFF0C\u90A3\u4E48\u53EF\u4EE5\u4F7F\u7528 "),I=a("fail2ban"),q=a(" \u6765\u9650\u5236\u4ED6\u7684 IP\u3002"),E=e(`<h2 id="\u5904\u7406\u4E00\u4E9B\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u5904\u7406\u4E00\u4E9B\u95EE\u9898" aria-hidden="true">#</a> \u5904\u7406\u4E00\u4E9B\u95EE\u9898</h2><h3 id="\u4FEE\u590D-ssh-add-\u5B58\u5728\u7684\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#\u4FEE\u590D-ssh-add-\u5B58\u5728\u7684\u95EE\u9898" aria-hidden="true">#</a> \u4FEE\u590D ssh-add \u5B58\u5728\u7684\u95EE\u9898</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 1. \u751F\u6210\u65B0\u7684 rsa \u540E\u9700\u8981\u94FE\u63A5\u5230 ssh</span>
ssh-add ~/.ssh/id_rsa_new
<span class="token comment"># 2. \u7136\u540E\u6B64\u5904\u4F1A\u62A5\u9519 Could not open a connection to your authentication agent.</span>
<span class="token comment"># 3. \u9700\u8981\u4FEE\u590D\u8BE5\u95EE\u9898</span>
<span class="token builtin class-name">eval</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>ssh-agent -s<span class="token variable">)</span></span>&quot;</span>
<span class="token comment"># 4. \u518D\u4E00\u6B21\u5C06\u65B0\u751F\u6210\u7684 rsa \u94FE\u63A5\u5230 ssh</span>
ssh-add ~/.ssh/id_rsa_new
<span class="token comment"># 5. \u663E\u793A\u6210\u529F </span>
Identity added: /home/yuan/.ssh/id_rsa_new <span class="token punctuation">(</span>your_email@example.com<span class="token punctuation">)</span>
<span class="token comment"># 6. \u6D4B\u8BD5\u662F\u5426\u6210\u529F</span>
ssh-add -l
</code></pre></div>`,3);function T(V,A){const o=t("OutboundLink"),c=t("RouterLink");return i(),p(l,null,[u,m,k,s("p",null,[s("a",_,[g,b,f,x,n(o)]),v]),y,s("p",null,[S,s("a",w,[P,n(o)]),L]),H,s("p",null,[N,n(c,{to:"/os/linux/fail2ban.html"},{default:d(()=>[I]),_:1}),q]),E],64)}var F=h(r,[["render",T]]);export{F as default};
