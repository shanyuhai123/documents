import{_ as o,c,a as n,b as p,d as a,e as t,w as l,r as i,o as r}from"./app-CQrWi6O2.js";const d={};function u(k,s){const e=i("RouteLink");return r(),c("div",null,[s[6]||(s[6]=n('<h1 id="内网穿透-frp" tabindex="-1"><a class="header-anchor" href="#内网穿透-frp"><span>内网穿透 FRP</span></a></h1><div class="hint-container tip"><p class="hint-container-title">提示</p><p>FRP（Fast Reverse Proxy）is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet. As of now, it supports <strong>TCP</strong> and <strong>UDP</strong>, as well as <strong>HTTP</strong> and <strong>HTTPS</strong> protocols, where requests can be forwarded to internal services by domain name.</p><p>来自 <a href="https://github.com/fatedier/frp" target="_blank" rel="noopener noreferrer">FRP</a></p></div><p>此处仅以配置 SSH 服务为示例。</p><h2 id="准备" tabindex="-1"><a class="header-anchor" href="#准备"><span>准备</span></a></h2><h3 id="_1-安全设置" tabindex="-1"><a class="header-anchor" href="#_1-安全设置"><span>1. 安全设置</span></a></h3>',5)),p("p",null,[s[1]||(s[1]=a("这是一件有风险的事情，所以开始前最好确认你的公网、内网服务器都已经做好防护工作，可参考",-1)),t(e,{to:"/os/linux/ssh-makes-your-server-more-secure.html"},{default:l(()=>[...s[0]||(s[0]=[a("SSH 让你的服务器更安全",-1)])]),_:1}),s[2]||(s[2]=a("。",-1))]),s[7]||(s[7]=n(`<h3 id="_2-资源下载" tabindex="-1"><a class="header-anchor" href="#_2-资源下载"><span>2. 资源下载</span></a></h3><p>需要在 github 上下载最新的 <a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noopener noreferrer">frp release</a> 到公网、内网服务器上，注意选择对应的版本。</p><h3 id="_3-端口开放" tabindex="-1"><a class="header-anchor" href="#_3-端口开放"><span>3. 端口开放</span></a></h3><p>如果是阿里云，需要在云实例中开放下方将要使用的端口。</p><ul><li><code>bind_port/server_port</code></li><li><code>remote_port</code></li></ul><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h2><h3 id="_1-公网服务器" tabindex="-1"><a class="header-anchor" href="#_1-公网服务器"><span>1. 公网服务器</span></a></h3><p>公网服务器修改 <code>frps.ini</code> 文件。</p><div class="language-ini" data-highlighter="prismjs" data-ext="ini" data-title="ini"><pre><code><span class="line"><span class="token comment"># frps.ini</span></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">bind_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7000</span></span>
<span class="line"></span></code></pre></div><p>配置解释：</p><ul><li><code>bind_port</code> 为 <code>frp</code> 服务器端接收客户端流量的端口</li></ul><p>启动服务端 <code>frp</code> 程序。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">nohup</span> ./frps <span class="token parameter variable">-c</span> frps.ini <span class="token operator">&amp;</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-内网服务器" tabindex="-1"><a class="header-anchor" href="#_2-内网服务器"><span>2. 内网服务器</span></a></h3><p>内网服务器修改 <code>frpc.ini</code> 文件。</p><div class="language-ini" data-highlighter="prismjs" data-ext="ini" data-title="ini"><pre><code><span class="line"><span class="token comment"># frpc.ini</span></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">server_addr</span> <span class="token punctuation">=</span> <span class="token value attr-value">x.x.x.x</span></span>
<span class="line"><span class="token key attr-name">server_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7000</span></span>
<span class="line"></span>
<span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">ssh</span><span class="token punctuation">]</span></span></span>
<span class="line"><span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">tcp</span></span>
<span class="line"><span class="token key attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token value attr-value">127.0.0.1</span></span>
<span class="line"><span class="token key attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">22</span></span>
<span class="line"><span class="token key attr-name">remote_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">6000</span></span>
<span class="line"></span></code></pre></div><p>配置解释：</p><ul><li><code>server_addr</code> 为 <code>frp</code> 服务端 <code>ip</code> 地址，也可以是域名</li><li><code>server_port</code> 为 <code>frp</code> 服务端的 <code>bind_port</code></li><li><code>local_ip</code> 为 <code>frp</code> 客户端的 <code>ip</code> 或 <code>127.0.0.1</code></li><li><code>local_port</code> 为 <code>frp</code> 客户端的 ssh 端口，其默认为 22，在安全设置时可能修改为其他</li><li><code>remote_port</code> 为 <code>frp</code> 客户端挂载到 <code>frp</code> 服务端的端口。在此示例中访问服务端 <code>6000</code> 端口相当于访问客户端 <code>22</code> 端口</li></ul><p>启动客户端 <code>frp</code> 程序。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">nohup</span> ./frpc <span class="token parameter variable">-c</span> frpc.ini <span class="token operator">&amp;</span></span>
<span class="line"></span></code></pre></div><h3 id="_3-停止服务" tabindex="-1"><a class="header-anchor" href="#_3-停止服务"><span>3. 停止服务</span></a></h3><p>以上述形式启动的服务，需要先找到进程号再停止。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> frp <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span></span>
<span class="line"><span class="token comment"># 72029</span></span>
<span class="line"><span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token number">72029</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 验证</span></span>
<span class="line"><span class="token function">ps</span> <span class="token parameter variable">-aux</span> <span class="token operator">|</span> <span class="token function">grep</span> frp <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span></span>
<span class="line"></span></code></pre></div><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><h3 id="_1-公网跳板-不推荐" tabindex="-1"><a class="header-anchor" href="#_1-公网跳板-不推荐"><span>1. 公网跳板（不推荐）</span></a></h3>`,25)),p("p",null,[s[4]||(s[4]=a("在之前安全设置中已经使用了密钥登录，为了简化操作可以配置 ",-1)),t(e,{to:"/os/linux/login-with-rsa-key.html#%E5%BF%AB%E9%80%9F%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E5%99%A8"},{default:l(()=>[...s[3]||(s[3]=[a("ssh config",-1)])]),_:1}),s[5]||(s[5]=a("。",-1))]),s[8]||(s[8]=n(`<div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 进入公网</span></span>
<span class="line"><span class="token function">ssh</span> aliyun</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 再从公网进入内网</span></span>
<span class="line"><span class="token function">ssh</span> private</span>
<span class="line"></span></code></pre></div><h3 id="_2-直接访问" tabindex="-1"><a class="header-anchor" href="#_2-直接访问"><span>2. 直接访问</span></a></h3><p>若公网服务端被黑了，就会导致黑客可以直接进入你的内网。当然如果希望公网只是一个跳板，方便其余机器进入也可以选择上一种方式。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 直接访问内网</span></span>
<span class="line"><span class="token comment"># 配置该 config 时可以认识到 \`local_port\` 与 \`remote_port\` 之间的关系</span></span>
<span class="line"><span class="token function">ssh</span> aliyun2private</span>
<span class="line"></span></code></pre></div><h2 id="systemd" tabindex="-1"><a class="header-anchor" href="#systemd"><span>systemd</span></a></h2><p>在下载对应的 <code>frp</code> 文件时，解压后注意到存在 <code>systemd</code> 文件夹，查看例如服务端配置。</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># cat systemd/frps.service</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Description</span><span class="token operator">=</span>Frp Server Service</span>
<span class="line"><span class="token assign-left variable">After</span><span class="token operator">=</span>network.target</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Type</span><span class="token operator">=</span>simple</span>
<span class="line"><span class="token assign-left variable">User</span><span class="token operator">=</span>nobody</span>
<span class="line"><span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure</span>
<span class="line"><span class="token assign-left variable">RestartSec</span><span class="token operator">=</span>5s</span>
<span class="line"><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/frps <span class="token parameter variable">-c</span> /etc/frp/frps.ini</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</span>
<span class="line"></span>
<span class="line"><span class="token comment"># cat systemd/frpc.service</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Description</span><span class="token operator">=</span>Frp Client Service</span>
<span class="line"><span class="token assign-left variable">After</span><span class="token operator">=</span>network.target</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">Type</span><span class="token operator">=</span>simple</span>
<span class="line"><span class="token assign-left variable">User</span><span class="token operator">=</span>nobody</span>
<span class="line"><span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure</span>
<span class="line"><span class="token assign-left variable">RestartSec</span><span class="token operator">=</span>5s</span>
<span class="line"><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/frpc <span class="token parameter variable">-c</span> /etc/frp/frpc.ini</span>
<span class="line"><span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/usr/bin/frpc reload <span class="token parameter variable">-c</span> /etc/frp/frpc.ini</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></span>
<span class="line"><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</span>
<span class="line"></span></code></pre></div><p>仅说明 <code>frps.service</code> 配置文件：</p><ul><li><code>frps</code> 启动程序放入 <code>/usr/bin</code> 目录中</li><li><code>frps.ini</code> 配置文件放入 <code>/etc/frp</code> 目录中</li><li><code>frps.service</code> 服务程序放入 <code>/lib/systemd/system</code> 目录中</li></ul><p>最后：</p><div class="language-bash" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 更新服务文件，记得加上 sudo</span></span>
<span class="line"><span class="token function">sudo</span> systemctl daemon-reload</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 开启</span></span>
<span class="line"><span class="token function">sudo</span> systemctl start frps</span>
<span class="line"></span></code></pre></div>`,11))])}const f=o(d,[["render",u]]),m=JSON.parse('{"path":"/os/ubuntu/frp.html","title":"内网穿透 FRP","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"准备","slug":"准备","link":"#准备","children":[{"level":3,"title":"1. 安全设置","slug":"_1-安全设置","link":"#_1-安全设置","children":[]},{"level":3,"title":"2. 资源下载","slug":"_2-资源下载","link":"#_2-资源下载","children":[]},{"level":3,"title":"3. 端口开放","slug":"_3-端口开放","link":"#_3-端口开放","children":[]}]},{"level":2,"title":"配置","slug":"配置","link":"#配置","children":[{"level":3,"title":"1. 公网服务器","slug":"_1-公网服务器","link":"#_1-公网服务器","children":[]},{"level":3,"title":"2. 内网服务器","slug":"_2-内网服务器","link":"#_2-内网服务器","children":[]},{"level":3,"title":"3. 停止服务","slug":"_3-停止服务","link":"#_3-停止服务","children":[]}]},{"level":2,"title":"使用","slug":"使用","link":"#使用","children":[{"level":3,"title":"1. 公网跳板（不推荐）","slug":"_1-公网跳板-不推荐","link":"#_1-公网跳板-不推荐","children":[]},{"level":3,"title":"2. 直接访问","slug":"_2-直接访问","link":"#_2-直接访问","children":[]}]},{"level":2,"title":"systemd","slug":"systemd","link":"#systemd","children":[]}],"git":{"updatedTime":1637399796000,"contributors":[{"name":"shanyuhai123","username":"shanyuhai123","email":"864299347@qq.com","commits":4,"url":"https://github.com/shanyuhai123"}]},"filePathRelative":"os/ubuntu/frp.md"}');export{f as comp,m as data};
