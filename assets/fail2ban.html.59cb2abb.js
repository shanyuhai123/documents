import{r as a,o as s,c as n,a as e,b as t,F as o,d as p,e as l}from"./app.658f3937.js";const r={},c=e("h2",{id:"安全",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#安全","aria-hidden":"true"},"#"),p(" 安全")],-1),i=p("服务器安全一直是一个问题，常使用 "),d={href:"https://github.com/fail2ban/fail2ban",target:"_blank",rel:"noopener noreferrer"},b=p("fail2ban"),k=p(" 来防止 SSH 暴力破解。"),h=l('<p>在启用 Web 服务后，常常会有一些脚本前来扫描是否存在漏洞，可以利用 <code>fail2ban</code> 禁用访问的 IP。还可以后端放出一些陷阱数据，正常用户界面不会展示，而一旦有爬虫访问了该数据，则禁用对应的 IP。</p><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用" aria-hidden="true">#</a> 使用</h2><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 安装</span>\nyum <span class="token function">install</span> fail2ban\n\n<span class="token comment"># 查看日志</span>\n<span class="token function">tail</span> -f /var/log/fail2ban.log\n</code></pre></div><p>在 <code>/etc/fail2ban/jail.conf</code> 明确指出不应该修改该文件，应当使用 <code>jail.local</code> 或 <code>jail.d/customisation.local</code>，个人更倾向于分模块处理。</p><h3 id="_1-ssh" tabindex="-1"><a class="header-anchor" href="#_1-ssh" aria-hidden="true">#</a> 1. SSH</h3><p>添加对 SSH 的限制：</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">tee</span> /etc/fail2ban/jail.d/sshd.local <span class="token operator">&lt;&lt;</span><span class="token string">&quot;EOF&quot;\n[sshd]\nenabled = true\nport = ssh\nfilter = sshd\n# 禁用时长\nbantime = 120\n# 允许失败次数\nmaxretry = 3\n# 查找失败次数的时长\nfindtime = 600\naction = iptables[name=SSH, port=ssh, protocol=tcp]\nEOF</span>\n</code></pre></div><p>查看该限制的情况：</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 查看所有 jail</span>\nfail2ban-client status\n<span class="token comment"># 查看指定 jail</span>\nfail2ban-client status sshd\n\n<span class="token comment"># 输出</span>\nStatus <span class="token keyword">for</span> the jail: sshd\n<span class="token operator">|</span>- Filter\n<span class="token operator">|</span>  <span class="token operator">|</span>- Currently failed: <span class="token number">0</span>\n<span class="token operator">|</span>  <span class="token operator">|</span>- Total failed:     <span class="token number">0</span>\n<span class="token operator">|</span>  <span class="token variable"><span class="token variable">`</span>- Journal matches:  <span class="token assign-left variable">_SYSTEMD_UNIT</span><span class="token operator">=</span>sshd.service + <span class="token assign-left variable">_COMM</span><span class="token operator">=</span>sshd\n<span class="token variable">`</span></span>- Actions\n   <span class="token operator">|</span>- Currently banned: <span class="token number">0</span>\n   <span class="token operator">|</span>- Total banned:     <span class="token number">0</span>\n   `- Banned IP list:\n</code></pre></div><p>用错误的密码尝试四次：</p><div class="language-bash ext-sh"><pre class="language-bash"><code>fail2ban-client status sshd\n\n<span class="token comment"># 输出</span>\nStatus <span class="token keyword">for</span> the jail: sshd\n<span class="token operator">|</span>- Filter\n<span class="token operator">|</span>  <span class="token operator">|</span>- Currently failed: <span class="token number">1</span>\n<span class="token operator">|</span>  <span class="token operator">|</span>- Total failed:     <span class="token number">4</span>\n<span class="token operator">|</span>  <span class="token variable"><span class="token variable">`</span>- Journal matches:  <span class="token assign-left variable">_SYSTEMD_UNIT</span><span class="token operator">=</span>sshd.service + <span class="token assign-left variable">_COMM</span><span class="token operator">=</span>sshd\n<span class="token variable">`</span></span>- Actions\n   <span class="token operator">|</span>- Currently banned: <span class="token number">0</span>\n   <span class="token operator">|</span>- Total banned:     <span class="token number">1</span>\n   `- Banned IP list: <span class="token number">10.0</span>.0.1\n</code></pre></div><p>再以正确的密码访问也会被拒绝，可以等待禁用时长过去，也可以手动放行：</p><div class="language-bash ext-sh"><pre class="language-bash"><code>fail2ban-client <span class="token builtin class-name">set</span> sshd unbanip <span class="token number">10.0</span>.0.1\n</code></pre></div>',13);r.render=function(p,l){const r=a("OutboundLink");return s(),n(o,null,[c,e("p",null,[i,e("a",d,[b,t(r)]),k]),h],64)};export{r as default};
