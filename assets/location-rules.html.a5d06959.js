import{r as n,c as a,a as s,b as t,F as e,e as o,d as c,o as p}from"./app.a0540cdc.js";import{_ as l}from"./plugin-vue_export-helper.5a098b48.js";const d={},r=o('<h2 id="规则" tabindex="-1"><a class="header-anchor" href="#规则" aria-hidden="true">#</a> 规则</h2><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Syntax:</span>\tlocation [ = | ~ | ~* | ^~ ] uri</span> <span class="token punctuation">{</span> ... <span class="token punctuation">}</span>\n\t\t<span class="token directive"><span class="token keyword">location</span> @name</span> <span class="token punctuation">{</span> ... <span class="token punctuation">}</span>\nDefault: —\nContext: server, location\n</code></pre></div>',2),i=c("可以看到 "),k={href:"https://nginx.org/en/docs/http/ngx_http_core_module.html#location",target:"_blank",rel:"noopener noreferrer"},u=c("location"),g=c(" 具备两种规则，其中 "),h=s("code",null,"@",-1),m=c(" 表示内部服务跳转，用于处理异常请求。"),x=o('<p>另外的是修饰符：</p><table><thead><tr><th style="text-align:center;">prefix</th><th style="text-align:center;">priority</th><th>desc</th></tr></thead><tbody><tr><td style="text-align:center;"><code>=</code></td><td style="text-align:center;">1</td><td>路径完全匹配</td></tr><tr><td style="text-align:center;"><code>~</code></td><td style="text-align:center;">3</td><td>区分大小写的正则匹配</td></tr><tr><td style="text-align:center;"><code>~*</code></td><td style="text-align:center;">3</td><td>不区分大小写的正则匹配</td></tr><tr><td style="text-align:center;">^~</td><td style="text-align:center;">2</td><td>前缀匹配</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;">4</td><td>不带任何修饰的前缀匹配，便于区分后续用 <code>none</code> 替代，Nginx 并无该说法</td></tr></tbody></table><h3 id="_1" tabindex="-1"><a class="header-anchor" href="#_1" aria-hidden="true">#</a> 1. <code>=</code></h3><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> = /abc</span> <span class="token punctuation">{</span>\n  <span class="token comment"># localhost/abc # 匹配</span>\n  <span class="token comment"># localhost/ABC # 据说 windows 大小写不敏感会匹配，但未测试</span>\n  <span class="token comment"># localhost/abc/ # 不匹配</span>\n  <span class="token comment"># localhost/abcd # 不匹配</span>\n  <span class="token comment"># localhost/abc?a=1 # 匹配</span>\n<span class="token punctuation">}</span>\n\n<span class="token directive"><span class="token keyword">location</span> = /abc/</span> <span class="token punctuation">{</span>\n  <span class="token comment"># localhost/abc/ # 匹配</span>\n  <span class="token comment"># localhost/abc # 不匹配</span>\n  <span class="token comment"># localhost/abc/a # 不匹配</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h3 id="_2-、" tabindex="-1"><a class="header-anchor" href="#_2-、" aria-hidden="true">#</a> 2. <code>~</code>、<code>~*</code></h3><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token comment"># 此处未对结尾做限制，`~*` 一致</span>\n<span class="token directive"><span class="token keyword">location</span> ~ ^/abc</span> <span class="token punctuation">{</span>\n  <span class="token comment"># localhost/abc # 匹配</span>\n  <span class="token comment"># localhost/abcd # 匹配</span>\n  <span class="token comment"># localhost/abc/a # 匹配</span>\n  <span class="token comment"># localhost/abc/a/b # 匹配</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h3 id="_3-、none" tabindex="-1"><a class="header-anchor" href="#_3-、none" aria-hidden="true">#</a> 3. <code>^~</code>、<code>none</code></h3><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token comment"># ^~ 一致，只是优先度更高</span>\n<span class="token directive"><span class="token keyword">location</span> /abc</span> <span class="token punctuation">{</span>\n  <span class="token comment"># localhost/abc # 匹配</span>\n  <span class="token comment"># localhost/abcd # 匹配</span>\n  <span class="token comment"># localhost/abcd/a # 匹配</span>\n  <span class="token comment"># localhost/abc/a/b # 匹配</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="顺序" tabindex="-1"><a class="header-anchor" href="#顺序" aria-hidden="true">#</a> 顺序</h2><p>伪代码：</p><div class="language-javascript ext-js"><pre class="language-javascript"><code><span class="token keyword">let</span> temp\n<span class="token keyword">if</span> <span class="token punctuation">(</span>精准匹配 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">=</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n  <span class="token keyword">return</span> 精准匹配的结果\n<span class="token keyword">else</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>前缀匹配<span class="token punctuation">)</span> <span class="token comment">// 前缀匹配包括 `^~` 和 啥都没有</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>前缀匹配 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">^~</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n      <span class="token keyword">return</span> 前缀匹配结果\n    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>前缀匹配 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">none</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>\n      temp <span class="token operator">=</span> 前缀匹配结果\n  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>正则匹配<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> 正则匹配结果\n<span class="token keyword">return</span> temp\n</code></pre></div><p>需要注意的是前缀匹配模式下与 <code>location</code> 在文件中的顺序无关，比的是谁的 <code>location</code> 更长；而正则匹配则跟顺序有关。</p>',12);var y=l(d,[["render",function(o,c){const l=n("OutboundLink");return p(),a(e,null,[r,s("p",null,[i,s("a",k,[u,t(l)]),g,h,m]),x],64)}]]);export{y as default};
