import{r as n,o as a,c as s,a as e,F as t,b as p,d as o}from"./app.ce027479.js";const c={},i=e("h2",{id:"请求限制",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#请求限制","aria-hidden":"true"},"#"),p(" 请求限制")],-1),l=p("请求限制 "),r={href:"https://nginx.org/en/docs/http/ngx_http_limit_req_module.html",target:"_blank",rel:"noopener noreferrer"},d=p("limit_req_module"),k=p(" 比连接限制更优化，由于一个连接可以被多次复用。"),u=o('<h3 id="_1-limit-req-zone" tabindex="-1"><a class="header-anchor" href="#_1-limit-req-zone" aria-hidden="true">#</a> 1. limit_req_zone</h3><p>首先需要在 <code>http</code> 作用域定义 <code>limit_req_zone</code>。</p><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Syntax:</span>\tlimit_req_zone key zone=name:size rate=rate [sync]</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Default:</span> —\nContext: http\n\n<span class="token comment"># Example</span>\nlimit_req_zone <span class="token variable">$binary_remote_addr</span> zone=one:10m rate=1r/s</span><span class="token punctuation">;</span>\n</code></pre></div><h3 id="_2-limit-req" tabindex="-1"><a class="header-anchor" href="#_2-limit-req" aria-hidden="true">#</a> 2. limit_req</h3><p>再在指定的作用域启用。</p><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Syntax:</span>\tlimit_req zone=name [burst=number] [nodelay | delay=number]</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Default:</span> —\nContext: http, server, location\n\n<span class="token comment"># Example</span>\nlimit_req_zone <span class="token variable">$binary_remote_addr</span> zone=one:10m rate=1r/s</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">location</span> /search/</span> <span class="token punctuation">{</span>\n  <span class="token directive"><span class="token keyword">limit_req</span> zone=one burst=5</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=perip:10m rate=1r/s</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$server_name</span> zone=perserver:10m rate=10r/s</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n  <span class="token directive"><span class="token keyword">limit_req</span> zone=perip burst=5 nodelay</span><span class="token punctuation">;</span>\n  <span class="token directive"><span class="token keyword">limit_req</span> zone=perserver burst=10</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div><p><code>$binary_remote_addr</code> 相对 <code>remote_addr</code> 占用的空间更少。</p><h2 id="连接限制" tabindex="-1"><a class="header-anchor" href="#连接限制" aria-hidden="true">#</a> 连接限制</h2>',8),m={href:"https://nginx.org/en/docs/http/ngx_http_limit_conn_module.html",target:"_blank",rel:"noopener noreferrer"},h=p("limit_conn_module"),_=p(" 步骤基本与请求限制一致。"),x=o('<h3 id="_1-limit-conn-zone" tabindex="-1"><a class="header-anchor" href="#_1-limit-conn-zone" aria-hidden="true">#</a> 1. limit_conn_zone</h3><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Syntax:</span>\tlimit_conn_zone key zone=name:size</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Default:</span> —\nContext: http\n\n<span class="token comment"># Example</span>\nlimit_conn_zone <span class="token variable">$binary_remote_addr</span> zone=addr:10m</span><span class="token punctuation">;</span>\n</code></pre></div><h3 id="_2-limit-zone" tabindex="-1"><a class="header-anchor" href="#_2-limit-zone" aria-hidden="true">#</a> 2. limit_zone</h3><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Syntax:</span>\tlimit_zone name <span class="token variable">$variable</span> size</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Default:</span> —\nContext: http\n\n<span class="token comment"># Example</span>\nlimit_conn_zone <span class="token variable">$binary_remote_addr</span> zone=perip:10m</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$server_name</span> zone=perserver:10m</span><span class="token punctuation">;</span>\n\n<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n  <span class="token directive"><span class="token keyword">limit_conn</span> perip <span class="token number">10</span></span><span class="token punctuation">;</span>\n  <span class="token directive"><span class="token keyword">limit_conn</span> perserver <span class="token number">100</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="访问-ip-限制" tabindex="-1"><a class="header-anchor" href="#访问-ip-限制" aria-hidden="true">#</a> 访问 IP 限制</h2>',5),v={href:"https://nginx.org/en/docs/http/ngx_http_access_module.html",target:"_blank",rel:"noopener noreferrer"},g=p("access_module"),y=p(" 可用来限制访问的 IP，用法比较简单。"),b=o('<div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Syntax:</span>\tallow address | CIDR | unix: | all</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Default:</span> —\nContext: http, server, location, limit_except\n\nSyntax:\tdeny address | CIDR | unix: | all</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Default:</span> —\nContext: http, server, location, limit_except\n\n<span class="token comment"># Example</span>\nlocation /</span> <span class="token punctuation">{</span>\n  <span class="token directive"><span class="token keyword">deny</span>  192.168.1.1</span><span class="token punctuation">;</span>\n  <span class="token directive"><span class="token keyword">allow</span> 192.168.1.0/24</span><span class="token punctuation">;</span>\n  <span class="token directive"><span class="token keyword">allow</span> 10.1.1.0/16</span><span class="token punctuation">;</span>\n  <span class="token directive"><span class="token keyword">allow</span> 2001:0db8::/32</span><span class="token punctuation">;</span>\n  <span class="token directive"><span class="token keyword">deny</span>  all</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="访问-账号-限制" tabindex="-1"><a class="header-anchor" href="#访问-账号-限制" aria-hidden="true">#</a> 访问 账号 限制</h2>',2),f={href:"https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html",target:"_blank",rel:"noopener noreferrer"},w=p("auth_basic_module"),z=p(" 可以为路径添加用户密码访问，可配合 IP 限制使用。"),q=o('<h3 id="_1-生成密码" tabindex="-1"><a class="header-anchor" href="#_1-生成密码" aria-hidden="true">#</a> 1. 生成密码</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 生成密码工具 htpasswd</span>\n<span class="token comment"># -b 参数为 在一行输入用户名和密码，而非根据提示输入密码</span>\n<span class="token comment"># -c 参数为 创建一个加密文件(注意已有则覆盖)，即增加用户时无需指定</span>\nhtpasswd -bc /etc/nginx/auth_conf shanyuhai <span class="token number">123</span>\n<span class="token comment"># 若缺乏依赖则提示，安装即可</span>\n<span class="token comment"># centos 下</span>\nyum <span class="token function">install</span> httpd-tools\n<span class="token comment"># ubuntu 下</span>\n<span class="token function">apt</span> <span class="token function">install</span> apache2-utils\n\n<span class="token function">cat</span> /etc/nginx/auth_conf <span class="token comment"># 验证</span>\n</code></pre></div><h3 id="_2-限制说明" tabindex="-1"><a class="header-anchor" href="#_2-限制说明" aria-hidden="true">#</a> 2. 限制说明</h3><div class="language-nginx ext-nginx"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">Syntax:</span>\tauth_basic string | <span class="token boolean">off</span></span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Default:</span> auth_basic <span class="token boolean">off</span></span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Context:</span> http, server, location, limit_except\n\nSyntax:\tauth_basic_user_file file</span><span class="token punctuation">;</span>\n<span class="token directive"><span class="token keyword">Default:</span> —\nContext: http, server, location, limit_except\n\n<span class="token comment"># Example</span>\nlocation /</span> <span class="token punctuation">{</span>\n  <span class="token directive"><span class="token keyword">auth_basic</span>           <span class="token string">&quot;请输入用户名、密码&quot;</span></span><span class="token punctuation">;</span>\n  <span class="token directive"><span class="token keyword">auth_basic_user_file</span> auth_conf</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div>',4);c.render=function(p,o){const c=n("OutboundLink");return a(),s(t,null,[i,e("p",null,[l,e("a",r,[d,e(c)]),k]),u,e("p",null,[e("a",m,[h,e(c)]),_]),x,e("p",null,[e("a",v,[g,e(c)]),y]),b,e("p",null,[e("a",f,[w,e(c)]),z]),q],64)};export default c;
